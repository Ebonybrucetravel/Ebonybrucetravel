{
	"info": {
		"_postman_id": "ebony-bruce-travels-api-v2",
		"name": "Ebony Bruce Travels API",
		"description": "Complete API collection for Ebony Bruce Travels Booking System\n\n**Base URL:** `{{baseUrl}}/api/v1`\n\n**Authentication:** Most endpoints require JWT Bearer token. Get token from `/auth/login` or `/auth/register`.\n\n**Environment Variables:**\n- `baseUrl`: http://localhost:3001 (or your Railway URL)\n- `token`: JWT token (auto-set after login)\n- `offerRequestId`: Duffel offer request ID (auto-set after flight search)\n- `offerId`: Selected flight offer ID (auto-set after listing offers)\n- `nextCursor`: Pagination cursor for next page (auto-set)\n- `bookingId`: Booking ID (auto-set after creating booking)\n\n**New Features (v2.0):**\n- âœ… Email verification on registration\n- âœ… Password reset/forgot password flow\n- âœ… Rate limiting (login: 5/min, register: 3/min)\n- âœ… Delayed login notification emails (10-20 min security feature)\n- âœ… Health check endpoints\n- âœ… Request correlation IDs\n- âœ… Audit logging for sensitive operations\n- âœ… OAuth (Facebook/Google) with graceful fallback\n\n---\n\n## ğŸ“‹ API Sections\n\n### 1. Authentication\n- **Register User** - Create new account (sends verification email)\n- **Login** - Get JWT token (triggers delayed security notification)\n- **Forgot Password** - Request password reset email\n- **Reset Password** - Reset password with token\n- **Verify Email** - Verify email address with token\n- **Facebook OAuth** - Social login with Facebook\n- **Google OAuth** - Social login with Google\n\n### 2. User Profile\n- **Get My Profile** - Retrieve current user profile\n- **Update Profile** - Update profile information\n- **Upload Profile Image** - Upload profile picture to Cloudinary\n- **Change Password** - Change password (email/password accounts only)\n- **Delete Account** - Soft delete account\n\n### 3. Health Check\n- **Health Check** - Service health status\n- **Database Health** - Database connection status\n\n### 4. Flight Search & Offers\n- **Search Flights** - Get `offer_request_id` (Step 1 of two-step process)\n- **List Offers** - Get paginated flight offers using `offer_request_id` (Step 2)\n  - Works identically for **one-way and round-trip** searches\n  - Same `offerRequestId` is used; each offer contains both outbound and return slices when `returnDate` is provided\n\n### 5. Bookings\n- **Create Booking** - Create a new booking (authenticated users)\n- **Create Guest Booking** - Create booking without account\n- **Get Booking** - Retrieve booking details by ID\n\n### 6. Payments\n- **Create Payment Intent** - Create Stripe payment intent for a booking\n- **Create Guest Payment Intent** - Create payment intent for guest booking\n- **Stripe Webhook** - Handle payment events\n\n### 7. Hotels & Images\n- **Hotels - Amadeus (Recommended)** - Search and book hotels via Amadeus, with server-side pagination and advanced filters\n- **Hotels - Duffel** - Duffel Stays endpoints (if enabled on your Duffel account)\n- **Hotels - Common Operations** - List/Get/Cancel hotel bookings for both providers\n- **Hotel Images** - Google Places + Cloudinary caching with graceful fallback and usage stats\n\n---\n\n## ğŸš€ Quick Start Guide\n\n### Step 1: Authentication\n1. **Register** or **Login** to get JWT token\n2. Token is automatically saved to `{{token}}` environment variable\n3. **Verify Email** after registration (check email for verification link)\n4. **Login** triggers delayed security notification email (10-20 min)\n\n### Step 2: Flight Search (Two-Step Process)\n1. **Search Flights** â†’ Get `offer_request_id` (no auth required)\n   - Returns immediately (2-3 seconds)\n   - Cached for 10 minutes\n2. **List Offers** â†’ Get paginated flights using `offer_request_id`\n   - Returns 20 offers per page\n   - Markup automatically applied\n   - Use `nextCursor` for pagination\n\n### Step 3: Create Booking\n1. Select an offer from List Offers response\n2. **Create Booking** with offer details\n3. Booking ID is saved to `{{bookingId}}`\n\n### Step 4: Payment\n1. **Create Payment Intent** using booking ID\n2. Returns `clientSecret` for Stripe Checkout\n3. Webhook automatically updates booking status on payment\n\n### Step 5: Manage Profile\n1. **Get My Profile** to view current information\n2. **Update Profile** to change name, phone, dateOfBirth, gender\n3. **Upload Profile Image** to set profile picture\n4. **Change Password** if needed (email/password accounts only)\n\n### Step 6: Hotels (Amadeus Flow)\n1. **Search Hotels (Amadeus)** â†’ Get hotel offers and `hotelId` / `offer.id`\n2. **Create Hotel Booking (Amadeus)** â†’ Store booking + encrypted card details\n3. **Create Payment Intent** â†’ Stripe payment for hotel booking\n4. **Stripe Webhook** â†’ Automatically creates Amadeus hotel order after payment\n5. **Get Hotel Booking** â†’ Retrieve details from Amadeus via unified booking endpoints\n6. **Get Hotel Images** â†’ Show cached or fallback images for search/detail pages\n\n---\n\n## ğŸ”’ Security Features\n\n### Rate Limiting\n- **Login**: 5 requests per minute\n- **Register**: 3 requests per minute\n- **Forgot Password**: 3 requests per minute\n- **Reset Password**: 5 requests per minute\n- **Global**: 100 requests per minute (other endpoints)\n\n### Email Verification\n- New registrations receive verification email\n- Email must be verified (optional, but recommended)\n- Verification token expires in 24 hours\n\n### Password Reset\n- Forgot password sends reset email\n- Reset token expires in 1 hour\n- Security: Doesn't reveal if email exists\n\n### Login Notifications\n- Delayed email notification (10-20 minutes after login)\n- Includes IP address and device information\n- Link to change password if suspicious activity\n- Helps detect unauthorized access\n\n### Audit Logging\n- Password changes are logged\n- Account deletions are logged\n- Includes IP address and user agent\n- Stored in `audit_logs` table\n\n---\n\n## ğŸ” Flight Search Flow (Why Two Requests?)\n\n**Step 1: Search** - Get `offer_request_id` (fast, 2-3 seconds)\n- Duffel searches airlines in background\n- Returns immediately with search ID\n- Cached for 10 minutes\n\n**Step 2: List Offers** - Use `offer_request_id` to get flights (fast, 1 second)\n- Paginated results (20 per page)\n- Markup applied automatically\n- Cached for 2 minutes\n- Works for **one-way and round-trip** searches; offers for round-trips include both slices (outbound + return) in a single priced offer\n\n**Benefits:**\n- âš¡ Faster user experience (3-4 seconds vs 20+ seconds)\n- ğŸ“„ Pagination (don't load 500 flights at once)\n- ğŸ’¾ Caching (reuse searches, reduce costs)\n- ğŸ’° Cost-effective (fetch only what you need)\n\n---\n\n## ğŸ’³ Payment Flow\n\n1. **Create Booking** â†’ Get `bookingId`\n2. **Create Payment Intent** â†’ Get `clientSecret`\n3. Use `clientSecret` with Stripe.js on frontend\n4. Stripe sends webhook events to `/payments/stripe/webhook`\n5. Booking status automatically updates:\n   - `payment_intent.succeeded` â†’ Booking status: `CONFIRMED`\n   - `payment_intent.payment_failed` â†’ Booking status: `FAILED`\n   - `charge.refunded` â†’ Booking status: `REFUNDED`\n\n---\n\n## ğŸ‘¤ User Profile Fields\n\n**Editable:**\n- `name` - Full name\n- `phone` - Phone number\n- `dateOfBirth` - Date of birth (YYYY-MM-DD format)\n- `gender` - Gender (Male, Female, Other, Prefer not to say)\n- `image` - Profile picture (via upload endpoint)\n\n**Read-only:**\n- `email` - Cannot be changed (security)\n- `emailVerified` - Email verification status\n- `role` - Set by system\n- `id` - Unique identifier\n\n---\n\n## ğŸ“ Testing Tips\n\n- Search endpoint returns `offer_request_id` (not offers)\n- Use List Offers endpoint to get actual flight options (one-way and round-trip)\n- Use `nextCursor` from response to paginate\n- Check `cached` field to see if result was from cache\n- All profile endpoints require authentication\n- Image upload accepts: jpg, jpeg, png, gif, webp (max 5MB)\n- Payment webhook requires Stripe webhook secret for signature verification\n- Rate limiting: If you get 429, wait a minute before retrying\n- Check health endpoint: `GET /api/v1/health` to verify service status\n- Correlation IDs: Check `X-Correlation-ID` header in responses for request tracking",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Authentication",
			"item": [
				{
					"name": "Register User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    if (response.token) {",
									"        pm.environment.set('token', response.token);",
									"        pm.environment.set('userId', response.user.id);",
									"        console.log('Token saved:', response.token);",
									"    }",
									"}",
									"",
									"pm.test('Status code is 201', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Response has user and token', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('user');",
									"    pm.expect(response).to.have.property('token');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"john.doe@example.com\",\n  \"name\": \"John Doe\",\n  \"password\": \"password123\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/register",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"register"
							]
						},
						"description": "Register a new user account.\n\n**No authentication required.**\n\n**Rate Limit:** 3 requests per minute\n\n**Request Body:**\n- `email` (string, required): User email address\n- `name` (string, required): User full name\n- `password` (string, required): Password (min 6 characters)\n\n**Response:**\n- Returns user object and JWT token\n- Token is automatically saved to environment variable\n- **Verification email sent** - Check email for verification link\n- Email verification is optional but recommended\n\n**Email Verification:**\n- Verification email sent immediately after registration\n- Contains verification link with token\n- Token expires in 24 hours\n- Use `/auth/verify-email` endpoint to verify\n\n**Error Responses:**\n- `409 Conflict` - Email already exists\n- `429 Too Many Requests` - Rate limit exceeded (3/min)\n\n**Note:** After registration, you'll receive a welcome email with email verification link."
					},
					"response": []
				},
				{
					"name": "Login User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    if (response.token) {",
									"        pm.environment.set('token', response.token);",
									"        pm.environment.set('userId', response.user.id);",
									"        console.log('Token saved:', response.token);",
									"    }",
									"}",
									"",
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"john.doe@example.com\",\n  \"password\": \"password123\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"login"
							]
						},
						"description": "Login with email and password.\n\n**No authentication required.**\n\n**Rate Limit:** 5 requests per minute\n\n**Request Body:**\n- `email` (string, required): User email address\n- `password` (string, required): User password\n\n**Response:**\n- Returns user object and JWT token\n- Token is automatically saved to environment variable\n\n**Security Features:**\n- **Delayed Login Notification**: Email sent 10-20 minutes after login (random delay)\n- Notification includes IP address, device info, and login time\n- Link to change password if suspicious activity detected\n- Helps detect unauthorized access\n\n**Error Responses:**\n- `401 Unauthorized` - Invalid credentials\n- `401 Unauthorized` - Account deleted\n- `401 Unauthorized` - OAuth-only account (use social login)\n- `429 Too Many Requests` - Rate limit exceeded (5/min)\n\n**Note:**\n- OAuth users (Facebook/Google) cannot use email/password login\n- Deleted accounts cannot log in\n- Login notification email is sent asynchronously (doesn't delay login response)"
					},
					"response": []
				},
				{
					"name": "Facebook OAuth Login",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"console.log('ğŸ”µ Initiating Facebook OAuth login...');",
									"console.log('ğŸ’¡ Note: This will redirect to Facebook for authentication');",
									"console.log('ğŸ’¡ After authentication, you will be redirected to the callback URL');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// OAuth redirects to external provider, so we check for redirect",
									"if (pm.response.code === 302 || pm.response.code === 200) {",
									"    console.log('âœ… Facebook OAuth initiated');",
									"    console.log('ğŸ’¡ Follow the redirect to complete authentication');",
									"}",
									"",
									"pm.test('OAuth flow initiated', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 302]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/facebook",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"facebook"
							]
						},
						"description": "Initiate Facebook OAuth login.\n\n**No authentication required.**\n\n**How it works:**\n1. This endpoint redirects to Facebook for authentication\n2. User authorizes the app on Facebook\n3. Facebook redirects to `/auth/facebook/callback`\n4. Backend creates/updates user and generates JWT token\n5. User is redirected to frontend with token in query params\n\n**Frontend Integration:**\n- Redirect user to this endpoint: `GET /api/v1/auth/facebook`\n- Handle callback at `/auth/callback?token=...&user=...`\n- Extract token and user from query params\n- Store token and redirect to dashboard\n\n**Environment Variables Required:**\n- `FACEBOOK_APP_ID` - Facebook App ID\n- `FACEBOOK_APP_SECRET` - Facebook App Secret\n- `FACEBOOK_CALLBACK_URL` - Callback URL (default: `/api/v1/auth/facebook/callback`)\n- `FRONTEND_URL` - Frontend URL for redirect after auth (default: `http://localhost:3000`)\n\n**Graceful Handling:**\n- If OAuth credentials are not configured, endpoint returns error gracefully\n- Application continues to work without OAuth\n- Check logs for OAuth configuration status\n\n**Note:** In Postman, this will show a redirect. In a browser, it will redirect to Facebook."
					},
					"response": []
				},
				{
					"name": "Google OAuth Login",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"console.log('ğŸ”´ Initiating Google OAuth login...');",
									"console.log('ğŸ’¡ Note: This will redirect to Google for authentication');",
									"console.log('ğŸ’¡ After authentication, you will be redirected to the callback URL');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// OAuth redirects to external provider, so we check for redirect",
									"if (pm.response.code === 302 || pm.response.code === 200) {",
									"    console.log('âœ… Google OAuth initiated');",
									"    console.log('ğŸ’¡ Follow the redirect to complete authentication');",
									"}",
									"",
									"pm.test('OAuth flow initiated', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 302]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/google",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"google"
							]
						},
						"description": "Initiate Google OAuth login.\n\n**No authentication required.**\n\n**How it works:**\n1. This endpoint redirects to Google for authentication\n2. User authorizes the app on Google\n3. Google redirects to `/auth/google/callback`\n4. Backend creates/updates user and generates JWT token\n5. User is redirected to frontend with token in query params\n\n**Frontend Integration:**\n- Redirect user to this endpoint: `GET /api/v1/auth/google`\n- Handle callback at `/auth/callback?token=...&user=...`\n- Extract token and user from query params\n- Store token and redirect to dashboard\n\n**Environment Variables Required:**\n- `GOOGLE_CLIENT_ID` - Google OAuth Client ID\n- `GOOGLE_CLIENT_SECRET` - Google OAuth Client Secret\n- `GOOGLE_CALLBACK_URL` - Callback URL (default: `/api/v1/auth/google/callback`)\n- `FRONTEND_URL` - Frontend URL for redirect after auth (default: `http://localhost:3000`)\n\n**Graceful Handling:**\n- If OAuth credentials are not configured, endpoint returns error gracefully\n- Application continues to work without OAuth\n- Check logs for OAuth configuration status\n\n**Note:** In Postman, this will show a redirect. In a browser, it will redirect to Google."
					},
					"response": []
				},
				{
					"name": "Forgot Password",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Password reset email sent', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"    pm.expect(response).to.have.property('message');",
									"    console.log('âœ… Password reset email sent (if account exists)');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"user@example.com\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/forgot-password",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"forgot-password"
							]
						},
						"description": "Request password reset email.\n\n**No authentication required.**\n\n**Rate Limit:** 3 requests per minute\n\n**Request Body:**\n- `email` (string, required): User email address\n\n**Response:**\n- Always returns success (security best practice - doesn't reveal if email exists)\n- If account exists, password reset email is sent\n- Reset token expires in 1 hour\n\n**Security:**\n- Does not reveal if email exists (prevents email enumeration)\n- Reset link sent to email if account exists\n- OAuth-only accounts are silently ignored\n\n**Error Responses:**\n- `429 Too Many Requests` - Rate limit exceeded (3/min)\n\n**Note:** Check email for password reset link. The link expires in 1 hour."
					},
					"response": []
				},
				{
					"name": "Reset Password",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Password reset successful', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"    pm.expect(response).to.have.property('message');",
									"    console.log('âœ… Password reset successfully');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"token\": \"reset-token-from-email\",\n  \"newPassword\": \"newSecurePassword123\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/reset-password",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"reset-password"
							]
						},
						"description": "Reset password with token from email.\n\n**No authentication required.**\n\n**Rate Limit:** 5 requests per minute\n\n**Request Body:**\n- `token` (string, required): Reset token from password reset email\n- `newPassword` (string, required): New password (min 6 characters)\n\n**Response:**\n- Returns success message\n- Password is updated\n- User can now login with new password\n\n**Error Responses:**\n- `400 Bad Request` - Invalid or expired token\n- `429 Too Many Requests` - Rate limit exceeded (5/min)\n\n**Note:**\n- Token expires in 1 hour\n- Token can only be used once\n- After reset, user must login with new password"
					},
					"response": []
				},
				{
					"name": "Verify Email",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Email verified successfully', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"    pm.expect(response).to.have.property('message');",
									"    console.log('âœ… Email verified successfully');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"token\": \"verification-token-from-email\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/verify-email",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"verify-email"
							]
						},
						"description": "Verify email address with token from registration email.\n\n**No authentication required.**\n\n**Rate Limit:** 10 requests per minute\n\n**Request Body:**\n- `token` (string, required): Verification token from registration email\n\n**Response:**\n- Returns success message\n- Email is marked as verified\n- `emailVerified` field set to `true`\n\n**Error Responses:**\n- `400 Bad Request` - Invalid or expired token\n- `400 Bad Request` - Email already verified\n- `429 Too Many Requests` - Rate limit exceeded (10/min)\n\n**Note:**\n- Token expires in 24 hours\n- Token can only be used once\n- Email verification is optional but recommended\n- Verification link is sent in welcome email after registration"
					},
					"response": []
				}
			],
			"description": "Authentication endpoints for user registration, login, password reset, email verification, and OAuth (Facebook/Google).\n\n**OAuth Flow:**\n1. User clicks \"Login with Facebook/Google\" on frontend\n2. Frontend redirects to `/auth/facebook` or `/auth/google`\n3. Backend redirects to OAuth provider (Facebook/Google)\n4. User authorizes on OAuth provider\n5. OAuth provider redirects to callback endpoint\n6. Backend creates/updates user and generates JWT token\n7. Backend redirects to frontend with token: `{FRONTEND_URL}/auth/callback?token=...&user=...`\n8. Frontend extracts token and stores it (localStorage/sessionStorage)\n9. Frontend redirects user to dashboard\n\n**Account Linking:**\n- If user logs in with OAuth and email already exists, OAuth account is linked to existing email account\n- If user logs in with email/password and then uses OAuth with same email, accounts are automatically linked"
		},
		{
			"name": "User Profile",
			"item": [
				{
					"name": "Get My Profile",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has user profile', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('id');",
									"    pm.expect(response).to.have.property('email');",
									"    pm.expect(response).to.have.property('name');",
									"    pm.expect(response).to.have.property('role');",
									"    console.log('âœ… Profile retrieved:', response.email);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/users/me",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"users",
								"me"
							]
						},
						"description": "Get current user's profile information.\n\n**Authentication required.**\n\n**Response includes:**\n- id, email, name, phone\n- image (Cloudinary URL)\n- dateOfBirth, gender\n- role, timestamps"
					},
					"response": []
				},
				{
					"name": "Update Profile",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Profile updated successfully', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('id');",
									"    pm.expect(response).to.have.property('email');",
									"    console.log('âœ… Profile updated:', response.name || response.email);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Seyi Obadeyi\",\n  \"phone\": \"+2348165000000\",\n  \"dateOfBirth\": \"1992-05-15\",\n  \"gender\": \"Male\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/users/me",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"users",
								"me"
							]
						},
						"description": "Update user profile information.\n\n**Authentication required.**\n\n**Editable fields:**\n- `name` - Full name\n- `phone` - Phone number\n- `dateOfBirth` - Date of birth (YYYY-MM-DD format)\n- `gender` - Gender (Male, Female, Other, Prefer not to say)\n\n**Note:** Email cannot be changed (security)."
					},
					"response": []
				},
				{
					"name": "Upload Profile Image",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Image uploaded successfully', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('image');",
									"    if (response.image) {",
									"        console.log('âœ… Image uploaded:', response.image);",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "image",
									"type": "file",
									"src": [],
									"description": "Profile image file (jpg, jpeg, png, gif, webp). Max 5MB. Auto-resized to 400x400px."
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/users/me/avatar",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"users",
								"me",
								"avatar"
							]
						},
						"description": "Upload or update user profile image.\n\n**Authentication required.**\n\n**Requirements:**\n- File format: jpg, jpeg, png, gif, webp\n- Max file size: 5MB\n- Auto-resized to 400x400px\n- Stored in Cloudinary\n- Old image automatically deleted when updating\n\n**Field name:** `image` (multipart/form-data)"
					},
					"response": []
				},
				{
					"name": "Change Password",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Password changed successfully', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"    pm.expect(response).to.have.property('message');",
									"    console.log('âœ… Password changed successfully');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"currentPassword\": \"oldPassword123\",\n  \"newPassword\": \"newPassword123\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/users/me/password",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"users",
								"me",
								"password"
							]
						},
						"description": "Change user password.\n\n**Authentication required.**\n\n**Request Body:**\n- `currentPassword` (string, required): Current password\n- `newPassword` (string, required): New password (minimum 6 characters)\n\n**Security:**\n- Current password is verified before allowing change\n- Password change is logged to audit table\n- Includes IP address and user agent in audit log\n\n**Error Responses:**\n- `400 Bad Request` - Invalid current password or OAuth account (cannot change password for social login accounts)\n- `401 Unauthorized` - Current password is incorrect\n- `404 Not Found` - User not found\n\n**Note:** OAuth users (Facebook/Google) cannot change password. They must use social login."
					},
					"response": []
				},
				{
					"name": "Delete Account",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Account deleted successfully', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"    pm.expect(response).to.have.property('message');",
									"    console.log('âœ… Account deleted successfully');",
									"    console.log('âš ï¸  Note: This is a soft delete. Account data is preserved but marked as deleted.');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/users/me",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"users",
								"me"
							]
						},
						"description": "Delete user account (soft delete).\n\n**Authentication required.**\n\n**What happens:**\n- Account is soft deleted (marked as deleted, not permanently removed)\n- Email is anonymized to ensure uniqueness\n- Profile image is deleted from Cloudinary\n- User cannot log in after deletion\n\n**Restrictions:**\n- Cannot delete account with active bookings (PENDING, PAYMENT_PENDING, CONFIRMED)\n- Must cancel or complete all bookings first\n\n**Error Responses:**\n- `400 Bad Request` - Account has active bookings\n\n**Note:** This is a soft delete. Account data is preserved for audit purposes but the user cannot log in."
					},
					"response": []
				}
			],
			"description": "User profile management endpoints.\n\n**All endpoints require authentication.**\n\n**Features:**\n- Get profile information\n- Update profile (name, phone, date of birth, gender)\n- Upload profile image to Cloudinary\n- Change password (email/password accounts only)\n- Delete account (soft delete)\n\n**Security & Audit:**\n- Password changes are logged to audit table\n- Account deletions are logged to audit table\n- Includes IP address and user agent in audit logs\n\n**Note:** Email cannot be changed (security requirement). OAuth users cannot change password."
		},
		{
			"name": "Health Check",
			"item": [
				{
					"name": "Health Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Service is healthy', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('status', 'ok');",
									"    pm.expect(response).to.have.property('uptime');",
									"    console.log('âœ… Service is healthy');",
									"    console.log('Uptime:', response.uptime, 'seconds');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/health",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"health"
							]
						},
						"description": "Check service health status.\n\n**No authentication required.**\n\n**Response:**\n- `status`: Service status (\"ok\" or \"error\")\n- `timestamp`: Current timestamp\n- `uptime`: Service uptime in seconds\n- `environment`: Current environment (development/production)\n\n**Use Cases:**\n- Load balancer health checks\n- Monitoring and alerting\n- Service status verification\n\n**Note:** This endpoint is public and doesn't require authentication."
					},
					"response": []
				},
				{
					"name": "Database Health Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Database status', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('status');",
									"    pm.expect(response).to.have.property('database');",
									"    if (response.database === 'connected') {",
									"        console.log('âœ… Database is connected');",
									"    } else {",
									"        console.log('âŒ Database is disconnected');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/health/db",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"health",
								"db"
							]
						},
						"description": "Check database connection health.\n\n**No authentication required.**\n\n**Response:**\n- `status`: Health status (\"ok\" or \"error\")\n- `database`: Database connection status (\"connected\" or \"disconnected\")\n- `timestamp`: Current timestamp\n- `error`: Error message (only in production if connection fails)\n\n**Use Cases:**\n- Database monitoring\n- Connection pool health checks\n- Troubleshooting database issues\n\n**Note:**\n- Returns 200 even if database is disconnected (for monitoring)\n- Check `database` field to determine actual status\n- Error details hidden in production for security"
					},
					"response": []
				}
			],
			"description": "Health check endpoints for monitoring service and database status.\n\n**No authentication required.**\n\n**Endpoints:**\n- **Health Check** - General service health\n- **Database Health** - Database connection status\n\n**Use Cases:**\n- Load balancer health checks\n- Monitoring dashboards\n- Alerting systems\n- Service status verification"
		},
		{
			"name": "Flight Search",
			"item": [
				{
					"name": "Search Flights - Get Offer Request ID",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has offer_request_id', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"    pm.expect(response.data).to.have.property('offer_request_id');",
									"    ",
									"    // Save offer_request_id for pagination",
									"    if (response.data.offer_request_id) {",
									"        pm.environment.set('offerRequestId', response.data.offer_request_id);",
									"        console.log('Offer Request ID saved:', response.data.offer_request_id);",
									"        console.log('Cached:', response.data.cached || false);",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"origin\": \"LHR\",\n  \"destination\": \"JFK\",\n  \"departureDate\": \"2026-01-25\",\n  \"passengers\": 1,\n  \"cabinClass\": \"economy\",\n  \"currency\": \"GBP\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/search/flights",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"bookings",
								"search",
								"flights"
							]
						},
						"description": "**STEP 1: Search for flights and get offer_request_id**\n\n**No authentication required.**\n\n**What This Does:**\n- Creates a flight search request with Duffel API\n- Returns immediately with `offer_request_id` (2-3 seconds)\n- Duffel continues searching airlines in background\n- Does NOT return flight offers (use Step 2 for that)\n\n**Why Two Steps?**\n- Faster response (don't wait 20+ seconds for all airlines)\n- Enables pagination (can't show 500 flights at once)\n- Allows caching (reuse searches, reduce costs)\n\n**Caching:**\n- Search results cached for 10 minutes\n- Same search parameters = cached `offer_request_id` (no API call)\n- Check `cached: true` in response to see if from cache\n\n**Request Body:**\n- `origin` (string, required): Origin airport IATA code (e.g., \"LHR\", \"LOS\", \"JFK\")\n- `destination` (string, required): Destination airport IATA code\n- `departureDate` (string, required): ISO 8601 date (YYYY-MM-DD)\n- `returnDate` (string, optional): For round trips (YYYY-MM-DD)\n- `passengers` (number, required): Number of passengers (min: 1)\n- `cabinClass` (string, optional): economy, premium_economy, business, first (default: economy)\n- `maxConnections` (number, optional): Max connections (0 = direct only, default: 1)\n- `passengerDetails` (array, optional): Detailed passenger info (age, type, etc.)\n\n**Response Structure:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"offer_request_id\": \"orq_0000B2dmFMfv0fyigjlHNI\",\n    \"live_mode\": false,\n    \"cached\": false,\n    \"message\": \"Use /bookings/offers endpoint to paginate offers\"\n  },\n  \"message\": \"Flight search completed...\"\n}\n```\n\n**Next Step:**\nUse the `offer_request_id` with **List Offers** endpoint to get actual flight options.\n\n**Example Scenarios:**\n\n**One-Way Flight:**\n```json\n{\n  \"origin\": \"LHR\",\n  \"destination\": \"JFK\",\n  \"departureDate\": \"2026-01-25\",\n  \"passengers\": 1,\n  \"cabinClass\": \"economy\",\n  \"currency\": \"GBP\"\n}\n```\n\n**Round Trip Flight (IMPORTANT - Add returnDate):**\n```json\n{\n  \"origin\": \"LHR\",\n  \"destination\": \"JFK\",\n  \"departureDate\": \"2026-01-25\",\n  \"returnDate\": \"2026-02-05\",\n  \"passengers\": 2,\n  \"cabinClass\": \"economy\",\n  \"currency\": \"GBP\"\n}\n```\n\n**Direct Flights Only:**\n```json\n{\n  \"origin\": \"LHR\",\n  \"destination\": \"JFK\",\n  \"departureDate\": \"2026-01-25\",\n  \"passengers\": 1,\n  \"maxConnections\": 0,\n  \"cabinClass\": \"economy\"\n}\n```\n\n**Business Class:**\n```json\n{\n  \"origin\": \"LHR\",\n  \"destination\": \"JFK\",\n  \"departureDate\": \"2026-01-25\",\n  \"passengers\": 1,\n  \"cabinClass\": \"business\",\n  \"currency\": \"GBP\"\n}\n```\n\n**With Children/Infants:**\n```json\n{\n  \"origin\": \"LHR\",\n  \"destination\": \"JFK\",\n  \"departureDate\": \"2026-01-25\",\n  \"passengers\": 3,\n  \"passengerDetails\": [\n    { \"type\": \"adult\" },\n    { \"type\": \"adult\" },\n    { \"type\": \"child\", \"age\": 5 }\n  ],\n  \"cabinClass\": \"economy\"\n}\n```\n\n**âš ï¸ ROUND TRIP TROUBLESHOOTING:**\n- Ensure `returnDate` is AFTER `departureDate`\n- Wait 20-30 seconds after search before calling List Offers (Duffel needs time to search)\n- Round trips may take longer to process than one-way\n- Check `offer_request_id` is valid before listing offers\n- Use the same `offer_request_id` for both outbound and return flights"
					},
					"response": []
				},
				{
					"name": "Search Flights - Round Trip Example",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    if (response.data && response.data.offer_request_id) {",
									"        pm.environment.set('offerRequestId', response.data.offer_request_id);",
									"        console.log('âœ… Round trip search successful!');",
									"        console.log('ğŸ“‹ Offer Request ID:', response.data.offer_request_id);",
									"        console.log('â³ Wait 20-30 seconds before calling List Offers');",
									"        console.log('ğŸ’¡ Round trips take longer to process than one-way');",
									"    }",
									"}",
									"",
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has offer_request_id', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"    pm.expect(response.data).to.have.property('offer_request_id');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"origin\": \"LHR\",\n  \"destination\": \"JFK\",\n  \"departureDate\": \"2026-01-25\",\n  \"returnDate\": \"2026-02-05\",\n  \"passengers\": 2,\n  \"cabinClass\": \"economy\",\n  \"currency\": \"GBP\",\n  \"maxConnections\": 1\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/search/flights",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "bookings", "search", "flights"]
						},
						"description": "**ROUND TRIP FLIGHT SEARCH EXAMPLE**\n\n**No authentication required.**\n\n**âš ï¸ IMPORTANT FOR ROUND TRIPS:**\n1. **Wait 20-30 seconds** after this search before calling List Offers\n2. Round trips take longer to process than one-way flights\n3. Duffel searches both outbound AND return flights\n4. Use the same `offer_request_id` for both directions\n\n**Key Difference from One-Way:**\n- **Add `returnDate`** field (must be AFTER `departureDate`)\n- Round trip searches create 2 slices (outbound + return)\n- Processing time is longer (20-30 seconds vs 10-15 seconds)\n\n**Request Body:**\n```json\n{\n  \"origin\": \"LHR\",\n  \"destination\": \"JFK\",\n  \"departureDate\": \"2026-01-25\",\n  \"returnDate\": \"2026-02-05\",  â† REQUIRED for round trips\n  \"passengers\": 2,\n  \"cabinClass\": \"economy\",\n  \"currency\": \"GBP\"\n}\n```\n\n**Response:**\n- Returns `offer_request_id` immediately (2-3 seconds)\n- Duffel continues searching in background\n- **Wait 20-30 seconds** before calling List Offers\n- Offers will include both outbound and return flights\n\n**Troubleshooting:**\n- âŒ No results? Wait longer (round trips take 20-30 seconds)\n- âŒ Invalid date? Ensure `returnDate` is AFTER `departureDate`\n- âŒ No offers? Try different dates or routes\n- âœ… Check `offer_request_id` is valid before listing offers\n\n**Next Steps:**\n1. Wait 20-30 seconds\n2. Call **List Offers** with the `offer_request_id`\n3. Offers will show combined round trip prices\n4. Each offer includes both outbound and return segments"
					},
					"response": []
				},
				{
					"name": "List Offers - First Page",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Ensure offerRequestId is set",
									"const offerRequestId = pm.environment.get('offerRequestId');",
									"if (!offerRequestId) {",
									"    console.error('âŒ No offerRequestId found!');",
									"    console.warn('âš ï¸  Please run \"Search Flights - Get Offer Request ID\" first.');",
									"} else {",
									"    console.log('âœ… Using offerRequestId:', offerRequestId);",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has paginated offers', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"    pm.expect(response).to.have.property('data');",
									"    pm.expect(response).to.have.property('meta');",
									"    pm.expect(response.data).to.be.an('array');",
									"    pm.expect(response.meta).to.have.property('nextCursor');",
									"    pm.expect(response.meta).to.have.property('hasMore');",
									"    ",
									"    // Save first offer ID if available",
									"    if (response.data && response.data.length > 0) {",
									"        pm.environment.set('offerId', response.data[0].id);",
									"        pm.environment.set('offerPrice', response.data[0].final_amount);",
									"        pm.environment.set('offerCurrency', response.data[0].currency);",
									"        console.log('âœ… Found', response.data.length, 'offers');",
									"        console.log('ğŸ“„ Has more:', response.meta.hasMore);",
									"        console.log('â¡ï¸  Next cursor:', response.meta.nextCursor || 'none');",
									"        console.log('ğŸ’° First offer price:', response.data[0].final_amount, response.data[0].currency);",
									"        console.log('ğŸ“Š Markup:', response.data[0].markup_percentage + '%');",
									"    } else {",
									"        console.warn('âš ï¸  No offers found. Try a different search.');",
									"    }",
									"    ",
									"    // Save next cursor for pagination",
									"    if (response.meta && response.meta.nextCursor) {",
									"        pm.environment.set('nextCursor', response.meta.nextCursor);",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/offers?offer_request_id={{offerRequestId}}&limit=20&sort=total_amount&sortOrder=asc",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"bookings",
								"offers"
							],
							"query": [
								{
									"key": "offer_request_id",
									"value": "{{offerRequestId}}",
									"description": "Offer request ID from search endpoint"
								},
								{
									"key": "limit",
									"value": "20",
									"description": "Items per page (1-200)",
									"disabled": false
								},
								{
									"key": "sort",
									"value": "total_amount",
									"description": "Sort field",
									"disabled": true
								},
								{
									"key": "sortOrder",
									"value": "asc",
									"description": "Sort order (asc/desc)",
									"disabled": true
								}
							]
						},
						"description": "**STEP 2: Get paginated flight offers**\n\n**No authentication required.**\n\n**What This Does:**\n- Fetches flight offers for a given `offer_request_id`\n- Returns paginated results (default: 20 per page)\n- Applies markup automatically (adds your profit margin)\n- Fast response (1 second)\n\n**Prerequisites:**\n- Must have `offer_request_id` from Step 1 (Search Flights)\n- Automatically saved to environment after search\n\n**Caching:**\n- Offers cached for 2 minutes\n- Same pagination params = cached results (no API call)\n- Prices change frequently, so short cache time\n\n**Query Parameters:**\n- `offer_request_id` (required): From search endpoint (auto-filled from environment)\n- `limit` (optional): Items per page (1-200, default: 20)\n- `cursor` (optional): For next/previous pages (from `meta.nextCursor`)\n- `sort` (optional): Sort field - `total_amount`, `total_duration`, `departure_time`\n- `sortOrder` (optional): `asc` (lowest first) or `desc` (highest first)\n\n**Response Structure:**\n```json\n{\n  \"success\": true,\n  \"data\": [\n    {\n      \"id\": \"off_123\",\n      \"original_amount\": \"500.00\",\n      \"markup_percentage\": 10,\n      \"markup_amount\": \"50.00\",\n      \"final_amount\": \"550.00\",\n      \"currency\": \"USD\",\n      \"slices\": [...],\n      \"segments\": [...],\n      \"expires_at\": \"2026-01-25T10:00:00Z\"\n    }\n  ],\n  \"meta\": {\n    \"count\": 20,\n    \"total\": 20,\n    \"limit\": 20,\n    \"nextCursor\": \"g2wAAAACbQAAABBBZXJvbWlzdC1LaGFya2l2bQAAAB=\",\n    \"prevCursor\": null,\n    \"hasMore\": true,\n    \"page\": 1,\n    \"totalPages\": 2\n  }\n}\n```\n\n**Pagination:**\n- Use `meta.nextCursor` for next page\n- Use `meta.prevCursor` for previous page\n- Check `meta.hasMore` to see if more pages available\n- Use \"List Offers - Next Page\" request with cursor\n\n**Markup Applied:**\n- `original_amount`: Price from airline\n- `markup_percentage`: Your profit margin\n- `markup_amount`: Profit in currency\n- `final_amount`: Price customer pays (original + markup)\n\n**Important:**\n- Offers expire (check `expires_at`)\n- Use offer `id` to create booking\n- Sort by price: `sort=total_amount&sortOrder=asc`"
					},
					"response": []
				},
				{
					"name": "List Offers - Next Page",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Get cursor from previous response or environment",
									"const cursor = pm.environment.get('nextCursor');",
									"const offerRequestId = pm.environment.get('offerRequestId');",
									"",
									"if (!offerRequestId) {",
									"    console.error('âŒ No offerRequestId found!');",
									"    console.warn('âš ï¸  Please run \"Search Flights\" first.');",
									"}",
									"",
									"if (!cursor) {",
									"    console.warn('âš ï¸  No cursor found. Getting first page instead.');",
									"    console.info('ğŸ’¡ Tip: Run \"List Offers - First Page\" first to get cursor.');",
									"} else {",
									"    console.log('âœ… Using cursor for next page:', cursor);",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has next page data', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"    pm.expect(response.meta).to.have.property('nextCursor');",
									"    ",
									"    // Save next cursor for subsequent pages",
									"    if (response.meta && response.meta.nextCursor) {",
									"        pm.environment.set('nextCursor', response.meta.nextCursor);",
									"        console.log('âœ… Next cursor saved:', response.meta.nextCursor);",
									"    } else {",
									"        console.log('â„¹ï¸  No more pages available');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/offers?offer_request_id={{offerRequestId}}&limit=20&cursor={{nextCursor}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"bookings",
								"offers"
							],
							"query": [
								{
									"key": "offer_request_id",
									"value": "{{offerRequestId}}"
								},
								{
									"key": "limit",
									"value": "20"
								},
								{
									"key": "cursor",
									"value": "{{nextCursor}}",
									"description": "Cursor from previous response meta.nextCursor"
								}
							]
						},
						"description": "**Get next page of offers using pagination cursor**\n\n**No authentication required.**\n\n**What This Does:**\n- Fetches the next page of offers using cursor from previous response\n- Automatically uses `nextCursor` from environment (set by previous request)\n\n**How It Works:**\n1. Call \"List Offers - First Page\" (no cursor)\n2. Response includes `meta.nextCursor`\n3. Call this endpoint (cursor auto-filled)\n4. Repeat until `meta.hasMore` is `false`\n\n**Query Parameters:**\n- `offer_request_id` (required): From search endpoint\n- `limit` (optional): Items per page (default: 20)\n- `cursor` (required): From `meta.nextCursor` of previous response (auto-filled)\n\n**Response:**\n- Same structure as first page\n- New `meta.nextCursor` for next page\n- `meta.hasMore` indicates if more pages\n\n**Example Flow:**\n```\nPage 1: ?offer_request_id=orq_123&limit=20\n  â†’ nextCursor: \"abc\"\n\nPage 2: ?offer_request_id=orq_123&limit=20&cursor=abc\n  â†’ nextCursor: \"def\"\n\nPage 3: ?offer_request_id=orq_123&limit=20&cursor=def\n  â†’ hasMore: false (no more pages)\n```"
					},
					"response": []
				},
				{
					"name": "List Offers - Sort by Price (Low to High)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/offers?offer_request_id={{offerRequestId}}&limit=20&sort=total_amount&sortOrder=asc",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"bookings",
								"offers"
							],
							"query": [
								{
									"key": "offer_request_id",
									"value": "{{offerRequestId}}"
								},
								{
									"key": "limit",
									"value": "20"
								},
								{
									"key": "sort",
									"value": "total_amount"
								},
								{
									"key": "sortOrder",
									"value": "asc"
								}
							]
						},
						"description": "Get offers sorted by price (lowest first)."
					},
					"response": []
				},
				{
					"name": "List Offers - Sort by Duration (Shortest First)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/offers?offer_request_id={{offerRequestId}}&limit=20&sort=total_duration&sortOrder=asc",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"bookings",
								"offers"
							],
							"query": [
								{
									"key": "offer_request_id",
									"value": "{{offerRequestId}}"
								},
								{
									"key": "limit",
									"value": "20"
								},
								{
									"key": "sort",
									"value": "total_duration"
								},
								{
									"key": "sortOrder",
									"value": "asc"
								}
							]
						},
						"description": "Get offers sorted by flight duration (shortest first)."
					},
					"response": []
				}
			],
			"description": "**Flight Search & Offers - Two-Step Process**\n\n**Complete Workflow:**\n1. **Search Flights** â†’ Get `offer_request_id` (2-3 seconds)\n   - Creates search request with Duffel\n   - Returns immediately with search ID\n   - Duffel searches airlines in background\n\n2. **List Offers** â†’ Get paginated flights (1 second)\n   - Use `offer_request_id` from step 1\n   - Get 20 flights per page (default)\n   - Markup automatically applied\n   - Use cursor to paginate\n\n3. **Create Booking** â†’ Use offer `id` from step 2\n   - Select an offer from results\n   - Use offer `id` to create booking\n\n**Why Two Requests?**\n- âš¡ **Faster**: User sees results in 3-4 seconds (vs 20+ seconds)\n- ğŸ“„ **Pagination**: Can't show 500 flights at once\n- ğŸ’¾ **Caching**: Reuse searches, reduce API costs\n- ğŸ’° **Cost-effective**: Fetch only what you need\n\n**Caching Benefits:**\n- Search results cached 10 minutes\n- Offers cached 2 minutes\n- Reduces API costs by 80-90%\n- Faster response times\n- Multiple users can share same search\n\n**Important Notes:**\n- Search endpoint does NOT return offers (only ID)\n- Must use List Offers endpoint to get flights\n- Offers expire (check `expires_at` field)\n- Use `offer_request_id` for all pagination requests"
		},
		{
			"name": "Bookings",
			"item": [
				{
					"name": "Create Booking (Authenticated)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (!pm.environment.get('token')) {",
									"    console.warn('No token found. Please login first.');",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 201', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    if (response.data.reference) {",
									"        pm.environment.set('bookingReference', response.data.reference);",
									"        pm.environment.set('bookingId', response.data.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"productType\": \"FLIGHT_INTERNATIONAL\",\n  \"provider\": \"DUFFEL\",\n  \"basePrice\": 45000,\n  \"currency\": \"GBP\",\n  \"bookingData\": {\n    \"offerId\": \"{{offerId}}\",\n    \"origin\": \"LHR\",\n    \"destination\": \"JFK\",\n    \"departureDate\": \"2026-01-25\",\n    \"airline\": \"British Airways\"\n  },\n  \"passengerInfo\": {\n    \"firstName\": \"John\",\n    \"lastName\": \"Doe\",\n    \"email\": \"john.doe@example.com\",\n    \"phone\": \"+1234567890\"\n  }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"bookings"
							]
						},
						"description": "Create a booking for an authenticated user.\n\n**Authentication required:** JWT Bearer token\n\n**Uses offer ID from flight search results.**"
					},
					"response": []
				},
				{
					"name": "Create Guest Booking",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"productType\": \"FLIGHT_INTERNATIONAL\",\n  \"provider\": \"DUFFEL\",\n  \"basePrice\": 45000,\n  \"currency\": \"GBP\",\n  \"bookingData\": {\n    \"offerId\": \"{{offerId}}\",\n    \"origin\": \"LHR\",\n    \"destination\": \"JFK\"\n  },\n  \"passengerInfo\": {\n    \"firstName\": \"Jane\",\n    \"lastName\": \"Smith\",\n    \"email\": \"jane.smith@example.com\",\n    \"phone\": \"+1234567890\"\n  }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/guest",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"bookings",
								"guest"
							]
						},
						"description": "Create a booking without authentication (guest checkout)."
					},
					"response": []
				},
				{
					"name": "List Bookings",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"bookings"
							]
						},
						"description": "Get list of bookings.\n\n**Authentication required.**\n- CUSTOMER: Sees only their bookings\n- ADMIN: Sees all bookings"
					},
					"response": []
				},
				{
					"name": "Get Booking by ID",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/{{bookingId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"bookings",
								"{{bookingId}}"
							]
						},
						"description": "Get booking details by ID."
					},
					"response": []
				},
				{
					"name": "Cancel Duffel Flight Booking",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (!pm.environment.get('token')) {",
									"    console.warn('âš ï¸  No token found. Please login first.');",
									"}",
									"",
									"if (!pm.environment.get('bookingId')) {",
									"    console.warn('âš ï¸  No bookingId found. Please create a booking first.');",
									"} else {",
									"    console.log('âœ… Cancelling booking:', pm.environment.get('bookingId'));",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
							"exec": [
								"pm.test('Status code is 200 or 403', function () {",
								"    pm.expect(pm.response.code).to.be.oneOf([200, 403, 400]);",
								"});",
								"",
								"if (pm.response.code === 403) {",
								"    console.error('âŒ Access denied. Only administrators can cancel bookings.');",
								"    console.log('ğŸ’¡ Tip: Use an admin account token');",
								"} else if (pm.response.code === 400) {",
								"    const response = pm.response.json();",
								"    console.error('âŒ Cancellation not allowed:', response.message || response.error);",
								"    console.log('ğŸ’¡ Possible reasons:');",
								"    console.log('   - Within 24 hours of departure');",
								"    console.log('   - Non-refundable fare');",
								"    console.log('   - Departure time has passed');",
								"} else if (pm.response.code === 200) {",
								"    const response = pm.response.json();",
								"    console.log('âœ… Booking cancelled successfully');",
								"    if (response.data.cancellationId) {",
								"        pm.environment.set('cancellationId', response.data.cancellationId);",
								"        console.log('ğŸ“‹ Cancellation ID:', response.data.cancellationId);",
								"    }",
								"    if (response.data.refundAmount) {",
								"        console.log('ğŸ’° Refund amount:', response.data.refundAmount, response.data.refundTo || '');",
								"    }",
								"    if (response.data.hasAirlineCredits) {",
								"        console.log('ğŸ« Airline credits issued (no cash refund)');",
								"    }",
								"}"
							],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/{{bookingId}}/cancel",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"bookings",
								"{{bookingId}}",
								"cancel"
							]
						},
						"description": "Cancel a Duffel flight booking (ADMIN ONLY).\n\n**âš ï¸ RESTRICTIONS:**\n- **Admin Only:** Only administrators (ADMIN, SUPER_ADMIN) can cancel bookings\n- **Time Restriction:** Cancellations are NOT allowed within 24 hours of departure\n- **Non-Refundable Fares:** Cancellations are blocked for non-refundable fares\n- **After Departure:** Cannot cancel after departure time has passed\n\n**Authentication required:** JWT Bearer token (Admin role)\n\n**Requirements:**\n- Booking must be a Duffel flight booking (`provider: DUFFEL`)\n- Booking must be in `CONFIRMED` status\n- User must have ADMIN or SUPER_ADMIN role\n- Departure must be more than 24 hours away\n- Fare must allow refunds (non-refundable fares blocked)\n\n**Process:**\n1. Validates cancellation restrictions (time, fare type)\n2. Creates pending cancellation in Duffel\n3. Confirms cancellation\n4. Updates booking status to `CANCELLED`\n5. Processes refund if applicable\n6. Sends cancellation email to customer\n\n**Response includes:**\n- `cancellationId` - Duffel cancellation ID\n- `refundAmount` - Refund amount (if applicable)\n- `refundTo` - Where refund goes (balance, airline_credits, card)\n- `hasAirlineCredits` - Whether airline issued credits instead of cash\n- `airlineCredits` - Credit details (if applicable)\n\n**Error Responses:**\n- `403 Forbidden` - User is not an administrator\n- `400 Bad Request` - Cancellation not allowed (time restriction or non-refundable fare)\n\n**Note:** Customers cannot cancel directly. They must contact support for cancellations."
					},
					"response": []
				},
				{
					"name": "Duffel Webhook (Test)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"type\": \"order.created\",\n  \"object\": {\n    \"id\": \"ord_0000A3tQcEcrfuFAb0RQPH\",\n    \"booking_reference\": \"ABC123\",\n    \"status\": \"confirmed\"\n  },\n  \"created_at\": \"2026-01-25T20:00:00Z\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/duffel/webhook",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"bookings",
								"duffel",
								"webhook"
							]
						},
						"description": "Duffel webhook endpoint for order updates.\n\n**âš ï¸ IMPORTANT:** This endpoint is called by Duffel, not by your application.\n\n**Configuration:**\n1. Go to Duffel Dashboard â†’ Webhooks\n2. Add endpoint: `https://your-domain.com/api/v1/bookings/duffel/webhook`\n3. Select events:\n   - `order.created` - Order successfully created\n   - `order.creation_failed` - Order creation failed\n   - `order.updated` - Order details updated\n   - `order.airline_initiated_change` - Airline changed the booking\n   - `order_cancellation.created` - Cancellation initiated\n   - `order_cancellation.confirmed` - Cancellation confirmed\n\n**Events Handled:**\n- `order.created` â†’ Updates booking with order details\n- `order.creation_failed` â†’ Marks booking as failed\n- `order.updated` â†’ Updates booking with latest order data\n- `order.airline_initiated_change` â†’ Stores change information\n- `order_cancellation.created` â†’ Stores cancellation details\n- `order_cancellation.confirmed` â†’ Updates booking to cancelled, processes refund\n\n**Note:** This request is for testing only. In production, Duffel calls this endpoint automatically.\n\n**Test Payload Example:**\n```json\n{\n  \"type\": \"order.created\",\n  \"object\": {\n    \"id\": \"ord_0000A3tQcEcrfuFAb0RQPH\",\n    \"booking_reference\": \"ABC123\",\n    \"status\": \"confirmed\"\n  },\n  \"created_at\": \"2026-01-25T20:00:00Z\"\n}\n```"
					},
					"response": []
				}
			],
			"description": "Booking management endpoints.\n\n**All endpoints require authentication (except webhook).**\n\n**Endpoints:**\n- Create Booking (Authenticated) - Create booking for logged-in user\n- Create Guest Booking - Create booking without account\n- Get Booking - Retrieve booking details by ID\n- Cancel Duffel Flight Booking - Cancel a confirmed Duffel flight booking\n- Duffel Webhook - Handle order updates from Duffel (no auth required)\n\n**Complete Booking Flow:**\n1. Search flights and get offers\n2. Select an offer\n3. Create booking with offer details\n4. Get booking ID\n5. Create payment intent using booking ID\n6. Payment succeeds â†’ Duffel order created automatically\n7. Duffel webhook updates booking with order details\n8. Cancel booking if needed (Duffel order cancelled automatically)\n\n**Order Creation:**\n- Duffel orders are created automatically when payment succeeds\n- No manual order creation needed\n- Order ID stored in `providerBookingId`\n- Full order data stored in `providerData`\n\n**Cancellation:**\n- Only Duffel flight bookings can be cancelled via this endpoint\n- Cancellation is immediate\n- Refunds processed automatically if applicable\n- Booking status updated to `CANCELLED`"
		},
		{
			"name": "Payments",
			"item": [
				{
					"name": "Create Payment Intent",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (!pm.environment.get('token')) {",
									"    console.warn('âš ï¸  No token found. Please login first.');",
									"}",
									"",
									"if (!pm.environment.get('bookingId')) {",
									"    console.warn('âš ï¸  No bookingId found. Please create a booking first.');",
									"    console.log('ğŸ’¡ Tip: Use \"Create Booking\" endpoint to get bookingId');",
									"} else {",
									"    console.log('âœ… Using bookingId:', pm.environment.get('bookingId'));",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200 or 201', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
									"});",
									"",
									"pm.test('Response has clientSecret', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('clientSecret');",
									"    pm.expect(response).to.have.property('paymentIntentId');",
									"    ",
									"    console.log('âœ… Payment intent created');",
									"    console.log('ğŸ’³ Payment Intent ID:', response.paymentIntentId);",
									"    console.log('ğŸ”‘ Client Secret:', response.clientSecret.substring(0, 20) + '...');",
									"    console.log('ğŸ’¡ Use clientSecret with Stripe.js on frontend');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"bookingId\": \"{{bookingId}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/payments/stripe/create-intent",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"payments",
								"stripe",
								"create-intent"
							]
						},
						"description": "Create a Stripe payment intent for a booking (authenticated user).\n\n**Authentication required.**\n\n**Prerequisites:**\n- Must have a booking ID (from Create Booking endpoint)\n- Booking must be in PENDING or PAYMENT_PENDING status\n- User must own the booking (or be ADMIN/SUPER_ADMIN)\n\n**Request:**\n```json\n{\n  \"bookingId\": \"clx1234567890\"\n}\n```\n\n**Response:**\n```json\n{\n  \"clientSecret\": \"pi_xxx_secret_xxx\",\n  \"paymentIntentId\": \"pi_xxx\"\n}\n```\n\n**Next Steps:**\n1. Use `clientSecret` with Stripe.js on frontend\n2. Stripe handles payment processing\n3. Webhook automatically updates booking status:\n   - `payment_intent.succeeded` â†’ Booking: `CONFIRMED`\n   - `payment_intent.payment_failed` â†’ Booking: `FAILED`\n   - `charge.refunded` â†’ Booking: `REFUNDED`\n\n**Note:** Webhook endpoint is `/api/v1/payments/stripe/webhook` (configured in Stripe Dashboard)"
					},
					"response": []
				},
				{
					"name": "Create Guest Payment Intent",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"bookingReference\": \"EBT-20260126-123456\",\n  \"email\": \"guest@example.com\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/payments/stripe/create-intent/guest",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"payments",
								"stripe",
								"create-intent",
								"guest"
							]
						},
						"description": "Create a Stripe payment intent for a **guest booking**.\n\n**Authentication:** Not required (public endpoint) âœ…\n\n**Security:**\n- Uses **booking reference** + **passenger email** to securely identify the booking\n- Common industry pattern for guest checkout (similar to PNR + last name)\n\n**Prerequisites:**\n- Guest booking must exist (from `Create Guest Booking` endpoint)\n- Booking must be in PENDING or PAYMENT_PENDING status\n- Email must match passenger or user email on the booking\n\n**Request:**\n```json\n{\n  \"bookingReference\": \"EBT-20260126-123456\",\n  \"email\": \"guest@example.com\"\n}\n```\n\n**Response:**\n```json\n{\n  \"clientSecret\": \"pi_xxx_secret_xxx\",\n  \"paymentIntentId\": \"pi_xxx\"\n}\n```\n\n**Next Steps:**\n1. Use `clientSecret` with Stripe.js on frontend\n2. Stripe handles payment processing\n3. Webhook automatically updates booking status\n\n**Note:** This flow is designed for guest checkout (no login required)."
					},
					"response": []
				},
				{
					"name": "Stripe Webhook (Test)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Webhook received', function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('received', true);",
									"    console.log('âœ… Webhook event processed');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "stripe-signature",
								"value": "t=1234567890,v1=signature_here",
								"description": "Stripe webhook signature (automatically added by Stripe)"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"id\": \"evt_xxx\",\n  \"type\": \"payment_intent.succeeded\",\n  \"data\": {\n    \"object\": {\n      \"id\": \"pi_xxx\",\n      \"metadata\": {\n        \"bookingId\": \"{{bookingId}}\"\n      }\n    }\n  }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/payments/stripe/webhook",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"payments",
								"stripe",
								"webhook"
							]
						},
						"description": "Stripe webhook endpoint for payment events.\n\n**âš ï¸ IMPORTANT:** This endpoint is called by Stripe, not by your application.\n\n**Configuration:**\n1. Go to Stripe Dashboard â†’ Webhooks\n2. Add endpoint: `https://your-domain.com/api/v1/payments/stripe/webhook`\n3. Select events:\n   - `payment_intent.succeeded`\n   - `payment_intent.payment_failed`\n   - `payment_intent.canceled`\n   - `charge.refunded`\n4. Copy webhook signing secret (starts with `whsec_...`)\n5. Add to `.env`: `STRIPE_WEBHOOK_SECRET=\"whsec_...\"`\n\n**Security:**\n- Webhook signature is verified automatically\n- Only legitimate Stripe events are processed\n- Invalid signatures are rejected\n\n**Events Handled:**\n- `payment_intent.succeeded` â†’ Updates booking to `CONFIRMED`\n- `payment_intent.payment_failed` â†’ Updates booking to `FAILED`\n- `payment_intent.canceled` â†’ Updates booking to `CANCELLED`\n- `charge.refunded` â†’ Updates booking to `REFUNDED`\n\n**Note:** This request is for testing only. In production, Stripe calls this endpoint automatically."
					},
					"response": []
				}
			],
			"description": "Payment processing endpoints using Stripe.\n\n**Payment Flow:**\n1. Create booking â†’ Get `bookingId`\n2. Create payment intent â†’ Get `clientSecret`\n3. Use `clientSecret` with Stripe.js on frontend\n4. Stripe processes payment\n5. Webhook updates booking status automatically\n\n**Webhook Setup:**\n- Configure in Stripe Dashboard\n- Endpoint URL: `https://your-domain.com/api/v1/payments/stripe/webhook`\n- Required events: `payment_intent.succeeded`, `payment_intent.payment_failed`, `payment_intent.canceled`, `charge.refunded`\n- Webhook secret required for security (signature verification)\n\n**Security:**\n- All payment endpoints verify webhook signatures\n- Only legitimate Stripe events are processed\n- Invalid signatures are rejected"
		},
		{
			"name": "Hotels",
			"item": [
				{
					"name": "Hotels - Amadeus (Recommended)",
					"description": "**ğŸ¯ RECOMMENDED: Use Amadeus for hotel bookings**\n\n**Why Amadeus?**\n- âœ… Free quota: 2,400-3,000 searches/month\n- âœ… Better test data (use big cities: LON, NYC, PAR)\n- âœ… More reliable and comprehensive\n- âœ… Advanced filtering (amenities, ratings, chain codes)\n- âœ… Map-based search support\n- âœ… Server-side pagination\n\n**ğŸ“‹ Complete Amadeus Hotel Booking Flow:**\n\n**Step 1: Search Hotels**\n`POST /api/v1/bookings/search/hotels/amadeus`\n- Search by city code, geographic coordinates, or hotel IDs\n- Returns hotel offers with pricing, policies, availability\n- Supports pagination, filtering, map-based search\n- **Save `offer.id` from response** (used in Step 2)\n\n**Step 2: Create Booking**\n`POST /api/v1/bookings/hotels/bookings/amadeus`\n- Use `offer.id` from Step 1 as `hotelOfferId`\n- Use `final_price` from offer as `offerPrice`\n- Provide guest details and payment card info\n- **Returns `booking.id`** (used in Step 3)\n- Booking status: `PENDING` (waiting for payment)\n\n**Step 3: Create Payment Intent**\n`POST /api/v1/payments/stripe/create-intent`\n- Use `booking.id` from Step 2\n- Returns `clientSecret` for Stripe Checkout\n\n**Step 4: Complete Payment**\n- Frontend: Use Stripe.js with `clientSecret`\n- User completes payment via Stripe\n\n**Step 5: Automatic Amadeus Booking (Webhook)**\n- After payment success, Stripe webhook triggers\n- System automatically creates Amadeus booking\n- Card details decrypted and sent to Amadeus\n- Booking status updates to `CONFIRMED`\n\n**Step 6: Get Booking (Optional)**\n`GET /api/v1/bookings/hotels/bookings/:bookingId`\n- View booking details from Amadeus\n- Automatically fetches latest data\n\n**Step 7: Cancel Booking (Admin Only)**\n`POST /api/v1/bookings/hotels/bookings/:bookingId/cancel`\n- Admin-only cancellation\n- Cancels in Amadeus system\n- Updates local database\n\n**ğŸ” Security:**\n- Card details encrypted with AES-256-GCM\n- Encrypted data cleared after successful booking\n- Only last 4 digits stored for display\n\n**ğŸ“Š API Versions:**\n- **Search**: v3 (`/v3/shopping/hotel-offers`) - Latest\n- **Booking**: v2 (`/v2/booking/hotel-orders`) - Latest\n- *Note: Different endpoints can have different version numbers - this is standard practice*",
					"item": [
						{
							"name": "1. Search Hotels (Amadeus)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('success', true);",
									"    pm.expect(response).to.have.property('data');",
									"    ",
									"    if (response.data && response.data.data && response.data.data.length > 0) {",
									"        const firstHotel = response.data.data[0];",
									"        if (firstHotel.offers && firstHotel.offers.length > 0) {",
									"            const firstOffer = firstHotel.offers[0];",
									"            if (firstOffer.id) {",
									"                pm.environment.set('amadeusOfferId', firstOffer.id);",
									"                console.log('âœ… Amadeus offer ID saved:', firstOffer.id);",
									"            }",
									"            if (firstHotel.hotel && firstHotel.hotel.hotelId) {",
									"                pm.environment.set('amadeusHotelId', firstHotel.hotel.hotelId);",
									"                console.log('âœ… Amadeus hotel ID saved:', firstHotel.hotel.hotelId);",
									"            }",
									"        }",
									"    }",
									"} else if (pm.response.code === 400) {",
									"    const response = pm.response.json();",
									"    console.error('âŒ Bad Request:', response.message);",
									"    if (response.errors && response.errors.length > 0) {",
									"        response.errors.forEach((err, idx) => {",
									"            console.error(`Error ${idx + 1}:`, err.title, '-', err.detail);",
									"            if (err.source && err.source.parameter) {",
									"                console.error('  Parameter:', err.source.parameter);",
									"            }",
									"        });",
									"    }",
									"} else if (pm.response.code === 401) {",
									"    console.error('âŒ Authentication failed. Check AMADEUS_API_KEY and AMADEUS_API_SECRET.');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"cityCode\": \"LON\",\n  \"checkInDate\": \"2026-06-04\",\n  \"checkOutDate\": \"2026-06-07\",\n  \"adults\": 2,\n  \"roomQuantity\": 1,\n  \"currency\": \"GBP\",\n  \"bestRateOnly\": true,\n  \"limit\": 20,\n  \"page\": 1\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/search/hotels/amadeus",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "bookings", "search", "hotels", "amadeus"]
						},
						"description": "**Search for hotels using Amadeus Self-Service API**\n\n**No authentication required.**\n\n**What This Does:**\n- Searches hotels using Amadeus v3 API\n- Returns hotel offers with pricing, policies, and availability\n- Applies currency conversion (2.5% buffer) and markup automatically\n- Cached for 5 minutes\n- Supports search by city code or specific hotel IDs\n\n**âš ï¸ IMPORTANT - Amadeus v3 API Requirements:**\n- Amadeus v3 `/shopping/hotel-offers` endpoint **requires `hotelIds`** (cityCode is NOT supported in v3)\n- When you provide `cityCode`, the system automatically:\n  1. Calls Hotel List API to get hotel IDs by city\n  2. Then searches for offers using those hotel IDs\n- Either `cityCode` OR `hotelIds` must be provided (not both, not neither)\n- Use big cities like LON (London), NYC (New York), PAR (Paris) for best results in test environment\n- Test environment has limited data - use production for full results\n\n**Search Methods:**\n\n**1. Search by City Code (Recommended - Automatic Hotel ID Lookup):**\n```json\n{\n  \"cityCode\": \"LON\",\n  \"checkInDate\": \"2026-06-04\",\n  \"checkOutDate\": \"2026-06-07\",\n  \"adults\": 2,\n  \"roomQuantity\": 1,\n  \"currency\": \"GBP\",\n  \"limit\": 20,\n  \"page\": 1\n}\n```\n*Note: System automatically fetches hotel IDs for the city, then searches (may take slightly longer)*\n\n**2. Search by Geographic Coordinates (Map-Based Search):**\n```json\n{\n  \"geographicCoordinates\": {\n    \"latitude\": 51.5071,\n    \"longitude\": -0.1416\n  },\n  \"radius\": 5,\n  \"radiusUnit\": \"KM\",\n  \"checkInDate\": \"2026-06-04\",\n  \"checkOutDate\": \"2026-06-07\",\n  \"adults\": 2,\n  \"roomQuantity\": 1,\n  \"currency\": \"GBP\",\n  \"amenities\": [\"SWIMMING_POOL\", \"SPA\", \"FITNESS_CENTER\"],\n  \"ratings\": [4, 5],\n  \"chainCodes\": [\"MC\"],\n  \"limit\": 20,\n  \"page\": 1\n}\n```\n*Note: Perfect for map-based hotel discovery. Supports radius, amenities, ratings, and chain filtering.*\n\n**3. Search by Hotel IDs (Faster - Direct Search):**\n```json\n{\n  \"hotelIds\": [\"MCLONGHM\", \"ADPAR001\"],\n  \"checkInDate\": \"2026-06-04\",\n  \"checkOutDate\": \"2026-06-07\",\n  \"adults\": 2,\n  \"roomQuantity\": 1,\n  \"currency\": \"GBP\",\n  \"limit\": 20,\n  \"page\": 1\n}\n```\n*Note: Get hotel IDs from previous searches or use Hotel List API*\n\n**Request Parameters:**\n\n**Required:**\n- `checkInDate` (string, required): Check-in date (YYYY-MM-DD). Must be today or future.\n- `checkOutDate` (string, required): Check-out date (YYYY-MM-DD). Must be after check-in date.\n- Either `cityCode`, `geographicCoordinates`, OR `hotelIds` (required): Search method\n  - `cityCode` (string): IATA city code (e.g., \"LON\", \"NYC\", \"PAR\")\n  - `geographicCoordinates` (object): Map-based search\n    - `latitude` (number, -90 to 90): Latitude\n    - `longitude` (number, -180 to 180): Longitude\n  - `hotelIds` (array): Amadeus property codes (8 chars each, e.g., [\"MCLONGHM\"])\n\n**Optional - Search Filters:**\n- `radius` (number, optional): Search radius in kilometers when using `geographicCoordinates` (1-100, default: 5)\n- `radiusUnit` (string, optional): Radius unit. Options: `KM`, `MILE` (default: KM)\n- `chainCodes` (array, optional): Hotel chain codes (2 chars each, e.g., [\"MC\", \"HI\"])\n- `amenities` (array, optional): Hotel amenities filter. Options: SWIMMING_POOL, SPA, FITNESS_CENTER, AIR_CONDITIONING, RESTAURANT, PARKING, PETS_ALLOWED, AIRPORT_SHUTTLE, BUSINESS_CENTER, DISABLED_FACILITIES, WIFI, MEETING_ROOMS, NO_KID_ALLOWED, TENNIS, GOLF, KITCHEN, ANIMAL_WATCHING, BABY-SITTING, BEACH, CASINO, JACUZZI, SAUNA, SOLARIUM, MASSAGE, VALET_PARKING, BAR or LOUNGE, KIDS_WELCOME, NO_PORN_FILMS, MINIBAR, TELEVISION, WI-FI_IN_ROOM, ROOM_SERVICE, GUARDED_PARKG, SERV_SPEC_MENU\n- `ratings` (array, optional): Hotel star ratings (1-5, e.g., [4, 5])\n- `hotelSource` (string, optional): Hotel source. Options: `BEDBANK`, `DIRECTCHAIN`, `ALL` (default: ALL)\n\n**Optional - Booking Parameters:**\n- `adults` (number, optional): Number of adults (1-9, default: 1)\n- `roomQuantity` (number, optional): Number of rooms (1-9, default: 1)\n- `currency` (string, optional): Currency code (default: GBP). Supported: GBP, USD, EUR, NGN, JPY, CNY, GHS, KES, ZAR\n- `priceRange` (string, optional): Price per night filter (e.g., \"200-300\", \"-300\", \"100\"). Requires `currency` if set.\n- `paymentPolicy` (string, optional): Filter by payment type. Options: `GUARANTEE`, `DEPOSIT`, `NONE` (default: NONE)\n- `boardType` (string, optional): Filter by meal plan. Options: `ROOM_ONLY`, `BREAKFAST`, `HALF_BOARD`, `FULL_BOARD`, `ALL_INCLUSIVE`\n- `includeClosed` (boolean, optional): Include sold-out properties (default: false)\n- `bestRateOnly` (boolean, optional): Return only cheapest offer per hotel (default: true)\n- `countryOfResidence` (string, optional): ISO 3166-1 country code (e.g., \"GB\")\n- `lang` (string, optional): Language for descriptions (e.g., \"EN\", \"fr-FR\")\n\n**Optional - Pagination:**\n- `limit` (number, optional): Hotels per page (1-100, default: 20)\n- `page` (number, optional): Page number (1-based, default: 1)\n\n**Response Structure:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"data\": [\n      {\n        \"type\": \"hotel-offers\",\n        \"hotel\": {\n          \"hotelId\": \"MCLONGHM\",\n          \"name\": \"JW Marriott Grosvenor House London\",\n          \"cityCode\": \"LON\",\n          \"chainCode\": \"MC\"\n        },\n        \"available\": true,\n        \"offers\": [\n          {\n            \"id\": \"TSXOJ6LFQ2\",\n            \"checkInDate\": \"2026-06-04\",\n            \"checkOutDate\": \"2026-06-07\",\n            \"price\": {\n              \"currency\": \"GBP\",\n              \"base\": \"716.00\",\n              \"total\": \"716.00\",\n              \"original_total\": \"716.00\",\n              \"original_currency\": \"GBP\"\n            },\n            \"final_price\": \"734.90\",\n            \"markup_percentage\": 10,\n            \"markup_amount\": \"7.17\",\n            \"conversion_fee\": \"0.00\",\n            \"room\": { ... },\n            \"policies\": { ... }\n          }\n        ]\n      }\n    ],\n    \"meta\": {\n      \"count\": 20,\n      \"total\": 45,\n      \"limit\": 20,\n      \"page\": 1,\n      \"totalPages\": 3,\n      \"hasMore\": true,\n      \"nextPage\": 2,\n      \"prevPage\": null\n    },\n    \"currency\": \"GBP\",\n    \"conversion_note\": \"Prices include a 2.5% conversion fee...\",\n    \"cached\": false\n  },\n  \"message\": \"Hotels retrieved successfully\"\n}\n```\n\n**Pagination Metadata:**\n- `count`: Number of hotels in current page\n- `total`: Total number of hotels matching search criteria\n- `limit`: Hotels per page\n- `page`: Current page number\n- `totalPages`: Total number of pages\n- `hasMore`: Whether there are more pages\n- `nextPage`: Next page number (null if last page)\n- `prevPage`: Previous page number (null if first page)\n\n**Price Breakdown:**\n- `original_price`: Price from Amadeus (before conversion)\n- `original_currency`: Currency from Amadeus (usually USD or hotel local currency)\n- `base_price`: Converted base price (no fees)\n- `conversion_fee`: Currency conversion buffer (2.5% default)\n- `price_after_conversion`: Base + conversion fee\n- `markup_percentage`: Business markup percentage\n- `markup_amount`: Markup amount\n- `final_price`: Total price customer pays (base + conversion fee + markup)\n\n**Common Error Codes:**\n- `61` - INVALID CURRENCY CODE\n- `137` - INVALID ADULTS OCCUPANCY REQUESTED\n- `145` - DURATION PERIOD OR DATES INCORRECT\n- `381` - INVALID CHECK-IN DATE (date in past)\n- `382` - INVALID CHECK-OUT DATE\n- `383` - INVALID CITY CODE\n- `392` - INVALID HOTEL CODE\n- `397` - INVALID NUMBER OF ADULTS\n- `400` - INVALID PROPERTY CODE\n- `404` - CHECK_OUT DATE MUST BE FURTHER IN THE FUTURE THAN CHECK-IN DATE\n- `424` - NO HOTELS FOUND WHICH MATCH THIS INPUT\n- `431` - CHECK-OUT DATE IS TOO FAR IN THE FUTURE\n\n**Error Response Format:**\n```json\n{\n  \"success\": false,\n  \"statusCode\": 400,\n  \"message\": \"INVALID CITY CODE\",\n  \"error\": \"Bad Request\",\n  \"errors\": [\n    {\n      \"status\": 400,\n      \"code\": 383,\n      \"title\": \"INVALID CITY CODE\",\n      \"detail\": \"The city code provided is not valid\",\n      \"source\": {\n        \"parameter\": \"cityCode\"\n      },\n      \"documentation\": \"https://developers.amadeus.com/...\"\n    }\n  ]\n}\n```\n\n**Tips:**\n- Use city codes for broad searches (LON, NYC, PAR, etc.)\n- Use `geographicCoordinates` for map-based hotel discovery\n- Use hotel IDs for specific hotels (get from previous searches)\n- Test environment has limited data - use big cities\n- `bestRateOnly: true` returns only cheapest offer per hotel (faster)\n- `bestRateOnly: false` returns all available offers (more options)\n- Prices are automatically converted to requested currency\n- Markup is applied based on your configuration\n- Use pagination (`limit`, `page`) to navigate through large result sets\n- Filter by `amenities`, `ratings`, `chainCodes` to narrow results\n- Results are cached for 5 minutes (same search returns instantly)\n\n**Free Quota:**\n- 2,400-3,000 free searches per month (depending on API version)\n- Additional requests charged per transaction\n\n**Use Case:**\n- Hotel search by location\n- Hotel search by specific properties\n- Price comparison across hotels\n- Filter by payment policy, meal plans, etc."
						},
						"response": []
					},
					{
						"name": "Get Hotel Details (Amadeus)",
						"request": {
							"method": "GET",
							"header": [],
							"url": {
								"raw": "{{baseUrl}}/api/v1/bookings/hotels/amadeus/:hotelId/details?includeImages=true&includeRatings=true&includeOffers=true&checkInDate=2026-06-04&checkOutDate=2026-06-07&adults=2&roomQuantity=1",
								"host": ["{{baseUrl}}"],
								"path": ["api", "v1", "bookings", "hotels", "amadeus", ":hotelId", "details"],
								"query": [
									{
										"key": "offerId",
										"value": "",
										"description": "Specific offer ID to get detailed pricing for",
										"disabled": true
									},
									{
										"key": "checkInDate",
										"value": "2026-06-04",
										"description": "Check-in date (YYYY-MM-DD) - Required for current offers"
									},
									{
										"key": "checkOutDate",
										"value": "2026-06-07",
										"description": "Check-out date (YYYY-MM-DD) - Required for current offers"
									},
									{
										"key": "adults",
										"value": "2",
										"description": "Number of adults (for current offers)"
									},
									{
										"key": "roomQuantity",
										"value": "1",
										"description": "Number of rooms (for current offers)"
									},
									{
										"key": "includeImages",
										"value": "true",
										"description": "Include hotel images (default: true)"
									},
									{
										"key": "includeRatings",
										"value": "true",
										"description": "Include hotel ratings/sentiments (default: true)"
									},
									{
										"key": "includeOffers",
										"value": "true",
										"description": "Include current offers if dates provided (default: true)"
									}
								]
							},
							"description": "**Get comprehensive hotel details (Amadeus)**\n\n**No authentication required.**\n\n**ğŸ¯ What This Does:**\n- Returns comprehensive hotel information in a single endpoint\n- Combines: hotel basic info, ratings, offers, and images\n- **Recommended endpoint for building hotel details pages**\n- Supports optional filtering and selective data inclusion\n\n**ğŸ“‹ URL Parameters:**\n- `hotelId` (string, required): Amadeus hotel ID (8 characters, e.g., \"MCLONGHM\")\n  - Get this from: `POST /api/v1/bookings/search/hotels/amadeus` â†’ `hotel.hotelId`\n\n**ğŸ“‹ Query Parameters:**\n- `offerId` (string, optional): Specific offer ID to get detailed pricing for\n- `checkInDate` (string, optional): Check-in date (YYYY-MM-DD) - Required if you want current offers\n- `checkOutDate` (string, optional): Check-out date (YYYY-MM-DD) - Required if you want current offers\n- `adults` (number, optional): Number of adults (default: 1)\n- `roomQuantity` (number, optional): Number of rooms (default: 1)\n- `includeImages` (boolean, optional): Include hotel images (default: true)\n- `includeRatings` (boolean, optional): Include hotel ratings/sentiments (default: true)\n- `includeOffers` (boolean, optional): Include current offers if dates provided (default: true)\n\n**âœ… Response Structure:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"hotel\": {\n      \"hotelId\": \"MCLONGHM\",\n      \"name\": \"JW Marriott Grosvenor House London\",\n      \"chainCode\": \"MC\",\n      \"cityCode\": \"LON\",\n      \"latitude\": 51.5074,\n      \"longitude\": -0.1278,\n      \"address\": {...},\n      \"amenities\": [\"WIFI\", \"PARKING\", \"RESTAURANT\"],\n      \"description\": \"...\"\n    },\n    \"ratings\": {\n      \"overallRating\": 4.5,\n      \"numberOfRatings\": 1234,\n      \"sentiment\": \"POSITIVE\",\n      \"categories\": [...]\n    },\n    \"offerPricing\": {...},\n    \"currentOffers\": [\n      {\n        \"id\": \"TSXOJ6LFQ2\",\n        \"price\": {...},\n        \"room\": {...},\n        \"policies\": {...}\n      }\n    ],\n    \"images\": {\n      \"images\": [\n        {\n          \"url\": \"https://res.cloudinary.com/...\",\n          \"type\": \"exterior\",\n          \"source\": \"google_places\"\n        }\n      ],\n      \"cached\": false,\n      \"fallbackUsed\": false\n    },\n    \"metadata\": {\n      \"hotelId\": \"MCLONGHM\",\n      \"offerId\": null,\n      \"checkInDate\": \"2026-06-04\",\n      \"checkOutDate\": \"2026-06-07\",\n      \"fetchedAt\": \"2026-02-03T10:30:00.000Z\"\n    }\n  }\n}\n```\n\n**ğŸ’¡ Usage Examples:**\n\n**1. Basic Hotel Info Only:**\n```\nGET /api/v1/bookings/hotels/amadeus/MCLONGHM/details\n```\n- Returns: Hotel basic info, ratings, images\n- No offers (dates not provided)\n\n**2. With Current Offers:**\n```\nGET /api/v1/bookings/hotels/amadeus/MCLONGHM/details?checkInDate=2026-06-04&checkOutDate=2026-06-07&adults=2\n```\n- Returns: Hotel info + current offers for dates\n- Includes pricing, room types, policies\n\n**3. Specific Offer Pricing:**\n```\nGET /api/v1/bookings/hotels/amadeus/MCLONGHM/details?offerId=TSXOJ6LFQ2\n```\n- Returns: Hotel info + detailed pricing for specific offer\n- Use when user selects a specific offer\n\n**4. Without Images (Faster):**\n```\nGET /api/v1/bookings/hotels/amadeus/MCLONGHM/details?includeImages=false\n```\n- Skips image fetching (faster response)\n- Use if images already loaded\n\n**5. Without Ratings (Faster):**\n```\nGET /api/v1/bookings/hotels/amadeus/MCLONGHM/details?includeRatings=false\n```\n- Skips ratings API call (faster response)\n\n**ğŸ¯ Complete Flow for Hotel Details Page:**\n\n```\n1. User clicks hotel from search results\n2. Frontend calls:\n   GET /api/v1/bookings/hotels/amadeus/{hotelId}/details?checkInDate=...&checkOutDate=...\n3. Backend returns:\n   - Hotel basic info\n   - Ratings/sentiments\n   - Current offers (if dates provided)\n   - Images (from Google Places or fallback)\n4. Frontend displays complete hotel details page\n```\n\n**ğŸ”— Related Endpoints:**\n- `POST /api/v1/bookings/search/hotels/amadeus` - Get hotelId from search\n- `GET /api/v1/bookings/hotels/:hotelId/images` - Get images separately (if needed)\n\n**âš ï¸ Important Notes:**\n- **All data is optional** - If a service fails, others still work\n- **Images always returned** - Uses fallback if Google Places unavailable\n- **Offers require dates** - Won't return offers without checkInDate/checkOutDate\n- **Ratings may be null** - Not all hotels have ratings data\n- **Fast response** - Uses caching where possible\n\n**ğŸ“Š Performance:**\n- **With all data**: ~2-3 seconds (multiple API calls)\n- **Without images**: ~1-2 seconds\n- **Without ratings**: ~1-2 seconds\n- **Basic info only**: ~0.5-1 second"
						},
						"response": []
					},
					{
						"name": "2. Create Hotel Booking (Amadeus)",
							"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"hotelOfferId\": \"{{amadeusOfferId}}\",\n  \"offerPrice\": 2002.40,\n  \"currency\": \"GBP\",\n  \"guests\": [\n    {\n      \"name\": {\n        \"title\": \"MR\",\n        \"firstName\": \"John\",\n        \"lastName\": \"Doe\"\n      },\n      \"contact\": {\n        \"phone\": \"+33679278416\",\n        \"email\": \"john.doe@example.com\"\n      }\n    }\n  ],\n  \"roomAssociations\": [\n    {\n      \"hotelOfferId\": \"{{amadeusOfferId}}\",\n      \"guestReferences\": [\n        {\n          \"guestReference\": \"1\"\n        }\n      ]\n    }\n  ],\n  \"payment\": {\n    \"method\": \"CREDIT_CARD\",\n    \"paymentCard\": {\n      \"paymentCardInfo\": {\n        \"vendorCode\": \"VI\",\n        \"cardNumber\": \"4151289722471370\",\n        \"expiryDate\": \"2026-08\",\n        \"holderName\": \"JOHN DOE\",\n        \"securityCode\": \"123\"\n      }\n    }\n  },\n  \"travelAgentEmail\": \"agent@example.com\",\n  \"accommodationSpecialRequests\": \"Late check-in requested\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/hotels/bookings/amadeus",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "bookings", "hotels", "bookings", "amadeus"]
						},
							"description": "**Create an Amadeus hotel booking**\n\n**Authentication required.**\n\n**What This Does:**\n- Creates a local booking for an Amadeus hotel offer\n- Stores booking details and guest information (card details encrypted)\n- Returns booking ID for payment intent creation\n- After payment succeeds, the actual Amadeus booking will be created automatically via webhook\n\n**âš ï¸ IMPORTANT - Complete Booking Flow:**\n\n**Step 1: Search Hotels (Amadeus)**\n`POST /api/v1/bookings/search/hotels/amadeus`\n- Get hotel offers with pricing\n- **Save `offer.id` from response** (this is your `hotelOfferId`)\n- **Save `final_price` from offer** (this is your `offerPrice`)\n\n**Step 2: Create Booking (This Endpoint)**\n`POST /api/v1/bookings/hotels/bookings/amadeus`\n- Use `offer.id` as `hotelOfferId`\n- Use `final_price` as `offerPrice`\n- Provide guest details and payment card info\n- **Returns `booking.id`** (used in Step 3)\n- Booking status: `PENDING` (waiting for payment)\n- Card details encrypted and stored securely\n\n**Step 3: Create Payment Intent**\n`POST /api/v1/payments/stripe/create-intent`\n- Use `booking.id` from Step 2\n- Returns `clientSecret` for Stripe Checkout\n\n**Step 4: Complete Payment**\n- Frontend: Use Stripe.js with `clientSecret`\n- User completes payment via Stripe\n\n**Step 5: Automatic Amadeus Booking (Webhook)**\n- After payment success, Stripe webhook triggers automatically\n- System decrypts card details\n- Creates actual booking in Amadeus system\n- Booking status updates to `CONFIRMED`\n\n**Request Body:**\n- `hotelOfferId` (string, required): Offer ID from search results (e.g., \"TSXOJ6LFQ2\")\n- `offerPrice` (number, required): Final price from offer (use `final_price` from search results)\n- `currency` (string, required): Currency code (ISO 4217, e.g., \"GBP\")\n- `guests` (array, required): Guest details\n  - `name` (object, required): Guest name\n    - `title` (string, required): MR, MRS, MS, MISS, DR, PROF\n    - `firstName` (string, required): First name\n    - `lastName` (string, required): Last name\n  - `contact` (object, required): Contact information\n    - `phone` (string, required): Phone in E.164 format (e.g., +33679278416)\n    - `email` (string, required): Email address\n- `roomAssociations` (array, required): Room and guest assignments\n  - `hotelOfferId` (string, required): Same as top-level hotelOfferId\n  - `guestReferences` (array, required): Guest references (1-based index)\n    - `guestReference` (string, required): \"1\", \"2\", etc. (matches guest index in `guests` array)\n- `payment` (object, required): Payment card information\n  - `method` (string, required): \"CREDIT_CARD\"\n  - `paymentCard` (object, required): Card details\n    - `paymentCardInfo` (object, required): Card information\n      - `vendorCode` (string, required): VI (Visa), MC (Mastercard), AX (Amex), CA (Carte Blanche), DC (Diners Club), DI (Discover), JC (JCB), TP (Universal Air Travel)\n      - `cardNumber` (string, required): Full card number (16 digits for most cards)\n      - `expiryDate` (string, required): YYYY-MM format (e.g., \"2026-08\")\n      - `holderName` (string, optional): Card holder name (as on card)\n      - `securityCode` (string, optional): CVV/CVC (3-4 digits)\n- `travelAgentEmail` (string, optional): Travel agent email\n- `accommodationSpecialRequests` (string, optional): Special requests (e.g., \"Late check-in requested\")\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"booking\": {\n      \"id\": \"clx1234567890\",\n      \"reference\": \"EBT-20260203-ABC123\",\n      \"status\": \"PENDING\",\n      \"paymentStatus\": \"PENDING\",\n      \"totalAmount\": \"2002.40\",\n      \"currency\": \"GBP\",\n      \"provider\": \"AMADEUS\"\n    },\n    \"message\": \"Booking created. Please proceed to payment.\"\n  },\n  \"message\": \"Booking created. Please proceed to payment.\"\n}\n```\n\n**Next Steps:**\n1. Use `booking.id` to create payment intent: `POST /api/v1/payments/stripe/create-intent`\n2. Complete payment via Stripe\n3. After payment success, Amadeus booking is created automatically (webhook)\n4. Booking status updates to `CONFIRMED`\n5. Get booking details: `GET /api/v1/bookings/hotels/bookings/:bookingId`\n\n**ğŸ” Security:**\n- Card details are encrypted with AES-256-GCM before storage\n- Only last 4 digits stored for display\n- Encrypted data cleared after successful Amadeus booking\n- Full card details decrypted only when creating Amadeus booking (after payment)\n\n**Example Request:**\n```json\n{\n  \"hotelOfferId\": \"{{amadeusOfferId}}\",\n  \"offerPrice\": 2002.40,\n  \"currency\": \"GBP\",\n  \"guests\": [\n    {\n      \"name\": {\n        \"title\": \"MR\",\n        \"firstName\": \"John\",\n        \"lastName\": \"Doe\"\n      },\n      \"contact\": {\n        \"phone\": \"+33679278416\",\n        \"email\": \"john.doe@example.com\"\n      }\n    }\n  ],\n  \"roomAssociations\": [\n    {\n      \"hotelOfferId\": \"{{amadeusOfferId}}\",\n      \"guestReferences\": [{\"guestReference\": \"1\"}]\n    }\n  ],\n  \"payment\": {\n    \"method\": \"CREDIT_CARD\",\n    \"paymentCard\": {\n      \"paymentCardInfo\": {\n        \"vendorCode\": \"VI\",\n        \"cardNumber\": \"4151289722471370\",\n        \"expiryDate\": \"2026-08\",\n        \"holderName\": \"JOHN DOE\",\n        \"securityCode\": \"123\"\n      }\n    }\n  }\n}\n```\n\n**Note:** Use `{{amadeusOfferId}}` from Step 1 (Search Hotels) response, and `final_price` as `offerPrice`."
						},
						"response": []
					}
					]
				},
				{
					"name": "Hotels - Duffel",
					"description": "**Duffel Stays API for hotel bookings**\n\n**âš ï¸ IMPORTANT:**\n- Requires Duffel Stays account access\n- May return `403 Forbidden` if not enabled for your account\n- Contact Duffel support to enable Stays API access\n\n**ğŸ“‹ Duffel Hotel Booking Flow:**\n\n**Step 1: Search Hotels**\n`POST /api/v1/bookings/search/hotels`\n- Search by location (coordinates) or accommodation IDs\n- Returns hotels with prices\n\n**Step 2: Get Hotel Rates**\n`GET /api/v1/bookings/hotels/rates/:searchResultId`\n- Get detailed rates for a specific hotel\n- Returns all room types and pricing\n\n**Step 3: Create Hotel Quote**\n`POST /api/v1/bookings/hotels/quotes`\n- Reserve a rate temporarily\n- Returns `quote_id`\n\n**Step 4: Create Hotel Booking**\n`POST /api/v1/bookings/hotels/bookings`\n- Use `quote_id` from Step 3\n- Provide guest details\n- Booking is immediately confirmed\n\n**Step 5: List/Get Hotel Bookings**\n- View bookings (see Common Operations)\n\n**Step 6: Cancel Hotel Booking (Admin Only)**\n- Admin-only cancellation (see Common Operations)\n\n**Utilities:**\n- **Get Accommodation Details** - Hotel info by ID\n- **Search Accommodation Suggestions** - Autocomplete\n- **Get Accommodation Reviews** - Guest reviews",
					"item": [
						{
							"name": "Search Hotels (Duffel)",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"location\": {\n    \"geographic_coordinates\": {\n      \"latitude\": 51.5071,\n      \"longitude\": -0.1416\n    },\n    \"radius\": 5\n  },\n  \"check_in_date\": \"2026-06-04\",\n  \"check_out_date\": \"2026-06-07\",\n  \"rooms\": 1,\n  \"guests\": [\n    { \"type\": \"adult\" },\n    { \"type\": \"adult\" }\n  ],\n  \"currency\": \"GBP\",\n  \"free_cancellation_only\": false\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/api/v1/bookings/search/hotels",
									"host": ["{{baseUrl}}"],
									"path": ["api", "v1", "bookings", "search", "hotels"]
								},
								"description": "**Search for hotels/accommodation (Duffel)**\n\n**No authentication required.**\n\n**What This Does:**\n- Searches hotels using Duffel Stays API\n- Returns hotels with prices (converted to selected currency)\n- Applies markup automatically\n- Cached for 5 minutes\n\n**âš ï¸ IMPORTANT:**\n- Requires Duffel Stays account access\n- May return `403 Forbidden` if not enabled\n- Contact Duffel support to enable Stays API\n\n**Search Methods:**\n\n**1. Location-Based Search (by coordinates):**\n```json\n{\n  \"location\": {\n    \"geographic_coordinates\": {\n      \"latitude\": 51.5071,\n      \"longitude\": -0.1416\n    },\n    \"radius\": 5\n  },\n  \"check_in_date\": \"2026-06-04\",\n  \"check_out_date\": \"2026-06-07\",\n  \"rooms\": 1,\n  \"guests\": [{ \"type\": \"adult\" }],\n  \"currency\": \"GBP\"\n}\n```\n\n**2. Accommodation-Based Search (by hotel IDs):**\n```json\n{\n  \"accommodation\": {\n    \"ids\": [\"acc_0000AWr2VsUNIF1Vl91xg0\"],\n    \"fetch_rates\": true\n  },\n  \"check_in_date\": \"2026-06-04\",\n  \"check_out_date\": \"2026-06-07\",\n  \"rooms\": 1,\n  \"guests\": [{ \"type\": \"adult\" }],\n  \"currency\": \"GBP\"\n}\n```\n\n**Request Parameters:**\n- `location` (object, optional): Location-based search\n  - `geographic_coordinates`: { `latitude` (-90 to 90), `longitude` (-180 to 180) }\n  - `radius` (number, optional): Search radius in km (1-100, default: 5)\n- `accommodation` (object, optional): Search by hotel IDs\n  - `ids` (array, required): List of accommodation IDs (max 10 with rates, 200 without)\n  - `fetch_rates` (boolean, optional): Whether to fetch rates (default: false)\n- `check_in_date` (string, required): ISO 8601 date (max 330 days in future)\n- `check_out_date` (string, required): ISO 8601 date (max 99 nights stay)\n- `rooms` (number, required): Number of rooms (min: 1)\n- `guests` (array, required): List of guests\n  - `type` (string, required): \"adult\" or \"child\"\n  - `age` (number, optional): Age for children (0-17)\n- `currency` (string, optional): Currency code (default: GBP). Supported: GBP, USD, EUR, NGN, JPY, CNY, GHS, KES, ZAR\n- `free_cancellation_only` (boolean, optional): Filter for free cancellation only (default: false)\n- `mobile` (boolean, optional): Whether search is from mobile (default: false)\n- `negotiated_rate_ids` (array, optional): Corporate/group rate IDs\n\n**Response:**\n- Returns hotels with `cheapest_rate_total_amount` (includes markup and conversion fee)\n- Each hotel includes `accommodation` details and available `rooms`\n- Prices are in selected currency with transparent conversion fee"
							},
							"response": []
						},
						{
							"name": "Get Hotel Rates (Duffel)",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/api/v1/bookings/hotels/rates/:searchResultId?currency=GBP",
									"host": ["{{baseUrl}}"],
									"path": ["api", "v1", "bookings", "hotels", "rates", ":searchResultId"],
									"query": [
										{
											"key": "currency",
											"value": "GBP",
											"description": "Currency code (default: GBP)"
										}
									]
								},
								"description": "**Get detailed rates for a specific hotel search result (Duffel)**\n\n**No authentication required.**\n\n**What This Does:**\n- Fetches all available rates for a hotel from search results\n- Returns detailed pricing for each room type\n- Applies currency conversion and markup\n\n**URL Parameters:**\n- `searchResultId` (string, required): Search result ID from hotel search\n\n**Query Parameters:**\n- `currency` (string, optional): Currency code (default: GBP)\n\n**Use Case:**\n- User clicks on a hotel from search results\n- Frontend calls this endpoint to get all room types and rates\n- Display detailed pricing options to user"
							},
							"response": []
						},
						{
							"name": "Create Hotel Quote (Duffel)",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"rate_id\": \"rat_0000BTVRuKZTavzrZDJ4cb\",\n  \"search_result_id\": \"srr_0000ASVBuJVLdmqtZDJ4ca\",\n  \"currency\": \"GBP\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/api/v1/bookings/hotels/quotes",
									"host": ["{{baseUrl}}"],
									"path": ["api", "v1", "bookings", "hotels", "quotes"]
								},
								"description": "**Create a hotel quote (reserve rate) - Duffel**\n\n**No authentication required.**\n\n**What This Does:**\n- Creates a quote for a specific hotel rate\n- Reserves the rate temporarily\n- Returns final pricing with all fees\n\n**Request Body:**\n- `rate_id` (string, required): Rate ID from hotel rates\n- `search_result_id` (string, required): Search result ID\n- `currency` (string, optional): Currency code (default: GBP)\n\n**Response:**\n- Returns quote with `quote_id`\n- Use `quote_id` to create booking\n- Quote includes all pricing breakdown"
							},
							"response": []
						},
						{
							"name": "Create Hotel Booking (Duffel)",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"quote_id\": \"quo_0000BTVRuKZTavzrZDJ4cb\",\n  \"email\": \"guest@example.com\",\n  \"phone_number\": \"+442080160509\",\n  \"guests\": [\n    {\n      \"given_name\": \"John\",\n      \"family_name\": \"Doe\",\n      \"type\": \"adult\"\n    }\n  ],\n  \"accommodation_special_requests\": \"Late check-in requested\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/api/v1/bookings/hotels/bookings",
									"host": ["{{baseUrl}}"],
									"path": ["api", "v1", "bookings", "hotels", "bookings"]
								},
								"description": "**Create a hotel booking (Duffel)**\n\n**Authentication required.**\n\n**What This Does:**\n- Creates a confirmed hotel booking using Duffel Stays API\n- Requires quote_id from Create Hotel Quote\n- Stores booking in database\n\n**Request Body:**\n- `quote_id` (string, required): Quote ID from Create Hotel Quote\n- `email` (string, required): Lead guest email\n- `phone_number` (string, required): Phone in E.164 format (e.g., +442080160509)\n- `guests` (array, required): Guest details\n  - `given_name` (string, required): First name\n  - `family_name` (string, required): Last name\n  - `type` (string, required): \"adult\" or \"child\"\n  - `age` (number, optional): Age for children (0-17)\n- `accommodation_special_requests` (string, optional): Special requests\n- `payment` (object, optional): Payment method (if paying via Duffel balance)\n- `metadata` (object, optional): Custom metadata\n\n**Response:**\n- Returns booking with `bookingId`\n- Booking is immediately confirmed\n- Use booking ID for payment processing"
							},
							"response": []
						},
						{
							"name": "Get Accommodation Details (Duffel)",
							"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/hotels/accommodation/:accommodationId",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "bookings", "hotels", "accommodation", ":accommodationId"]
						},
						"description": "**Get accommodation/hotel details by ID**\n\n**No authentication required.**\n\n**URL Parameters:**\n- `accommodationId` (string, required): Accommodation ID\n\n**Use Case:**\n- Display hotel details page\n- Show amenities, location, photos\n- Use before searching for rates"
					},
							"response": []
						},
						{
							"name": "Search Accommodation Suggestions (Duffel)",
							"request": {
								"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"query\": \"london\",\n  \"location\": {\n    \"geographic_coordinates\": {\n      \"latitude\": 51.5071,\n      \"longitude\": -0.1416\n    },\n    \"radius\": 10\n  }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/hotels/accommodation/suggestions",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "bookings", "hotels", "accommodation", "suggestions"]
						},
						"description": "**Search for hotel/accommodation suggestions (autocomplete)**\n\n**No authentication required.**\n\n**What This Does:**\n- Provides autocomplete suggestions for hotel search\n- Minimum 3 characters required\n- Optional location-based filtering\n\n**Request Body:**\n- `query` (string, required): Search query (min 3 characters)\n- `location` (object, optional): Location filter\n  - `geographic_coordinates`: { `latitude`, `longitude` }\n  - `radius` (number, optional): Radius in km (1-100, default: 5)\n\n**Use Case:**\n- Hotel search autocomplete\n- Location-based suggestions\n- Find hotels by name or location"
					},
							"response": []
						},
						{
							"name": "Get Accommodation Reviews (Duffel)",
							"request": {
								"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/hotels/accommodation/:accommodationId/reviews?limit=20",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "bookings", "hotels", "accommodation", ":accommodationId", "reviews"],
							"query": [
								{
									"key": "limit",
									"value": "20",
									"description": "Items per page"
								},
								{
									"key": "after",
									"value": "",
									"description": "Pagination cursor",
									"disabled": true
								}
							]
						},
						"description": "**Get accommodation reviews**\n\n**No authentication required.**\n\n**URL Parameters:**\n- `accommodationId` (string, required): Accommodation ID\n\n**Query Parameters:**\n- `limit` (number, optional): Items per page\n- `after` (string, optional): Pagination cursor\n- `before` (string, optional): Previous page cursor\n\n**Response:**\n- Returns paginated guest reviews\n- Includes ratings, comments, dates"
					},
							"response": []
						}
					]
				},
				{
					"name": "Hotels - Common Operations",
					"description": "**Common hotel booking operations that work for both Duffel and Amadeus**\n\nThese endpoints automatically detect the provider (Duffel or Amadeus) and work seamlessly with both.\n\n**Endpoints:**\n- **List Hotel Bookings** - View all user's hotel bookings (both providers)\n- **Get Hotel Booking** - Get booking details (automatically fetches from correct provider)\n- **Cancel Hotel Booking** - Admin-only cancellation (works for both providers)",
					"item": [
						{
							"name": "List Hotel Bookings",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{token}}"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/api/v1/bookings/hotels/bookings?limit=20",
									"host": ["{{baseUrl}}"],
									"path": ["api", "v1", "bookings", "hotels", "bookings"],
									"query": [
										{
											"key": "limit",
											"value": "20",
											"description": "Items per page"
										},
										{
											"key": "cursor",
											"value": "",
											"description": "Pagination cursor",
											"disabled": true
										}
									]
								},
								"description": "**List user's hotel bookings**\n\n**Authentication required.**\n\n**Query Parameters:**\n- `limit` (number, optional): Items per page (default: 20, max: 200)\n- `cursor` (string, optional): Pagination cursor\n\n**Response:**\n- Returns paginated list of hotel bookings\n- Includes booking details, dates, pricing\n- Works for both Duffel and Amadeus bookings"
							},
							"response": []
						},
						{
							"name": "Get Hotel Booking",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{token}}"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/api/v1/bookings/hotels/bookings/:bookingId",
									"host": ["{{baseUrl}}"],
									"path": ["api", "v1", "bookings", "hotels", "bookings", ":bookingId"]
								},
								"description": "**Get hotel booking details**\n\n**Authentication required.**\n\n**URL Parameters:**\n- `bookingId` (string, required): Booking ID\n\n**Response:**\n- Returns full booking details from provider (Duffel or Amadeus)\n- Includes accommodation, guests, dates, pricing\n- Supports both Duffel and Amadeus hotel bookings\n- Automatically fetches latest data from provider API\n- Falls back to cached data if provider API fails"
							},
							"response": []
						},
						{
							"name": "Cancel Hotel Booking (Admin Only)",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{token}}"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/api/v1/bookings/hotels/bookings/:bookingId/cancel",
									"host": ["{{baseUrl}}"],
									"path": ["api", "v1", "bookings", "hotels", "bookings", ":bookingId", "cancel"]
								},
								"description": "**Cancel a hotel booking (Admin Only)**\n\n**Admin authentication required.**\n\n**What This Does:**\n- Cancels hotel booking in provider (Duffel or Amadeus)\n- Updates local database\n- Only admins can cancel (same as flight cancellations)\n- Supports both Duffel and Amadeus hotel bookings\n\n**URL Parameters:**\n- `bookingId` (string, required): Booking ID to cancel\n\n**Response:**\n- Returns cancellation confirmation\n- Booking status updated to CANCELLED\n- Refund status updated if applicable\n\n**Note:**\n- Works for both Duffel and Amadeus hotel bookings\n- Cancellation policies depend on hotel provider\n- Refunds processed according to hotel cancellation policy"
							},
							"response": []
						},
						{
							"name": "Get Hotel Images",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/api/v1/bookings/hotels/:hotelId/images?hotelName=JW+Marriott+Grosvenor+House+London&googlePlaceId=",
									"host": ["{{baseUrl}}"],
									"path": ["api", "v1", "bookings", "hotels", ":hotelId", "images"],
									"query": [
										{
											"key": "hotelName",
											"value": "JW Marriott Grosvenor House London",
											"description": "Hotel name (required for Google Places search)",
											"disabled": false
										},
										{
											"key": "googlePlaceId",
											"value": "",
											"description": "Google Place ID (optional, if you have it)",
											"disabled": true
										}
									]
								},
								"description": "**Get hotel images with caching and fallback support**\n\n**No authentication required.**\n\n**ğŸ¯ What This Does:**\n- Fetches hotel images from Google Places API (if configured)\n- Caches images in Cloudinary for 60 days\n- **Automatically falls back to placeholder images** if:\n  - Google Places API key is missing/invalid\n  - Hotel not found in Google Places\n  - Rate limit reached\n  - Any error occurs\n- **Never crashes** - always returns images\n\n**ğŸ“‹ URL Parameters:**\n- `hotelId` (string, required): Hotel ID from search results (e.g., \"MCLONGHM\")\n  - Get this from: `POST /api/v1/bookings/search/hotels/amadeus` â†’ `hotel.hotelId`\n\n**ğŸ“‹ Query Parameters:**\n- `hotelName` (string, required): Hotel name for Google Places search\n  - Get this from: `POST /api/v1/bookings/search/hotels/amadeus` â†’ `hotel.name`\n  - Example: \"JW Marriott Grosvenor House London\"\n- `googlePlaceId` (string, optional): Google Place ID if you have it (skips search step)\n\n**âœ… Response Structure:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"hotelId\": \"MCLONGHM\",\n    \"hotelName\": \"JW Marriott Grosvenor House London\",\n    \"images\": [\n      {\n        \"url\": \"https://res.cloudinary.com/.../hotel_MCLONGHM_0.jpg\",\n        \"type\": \"exterior\",\n        \"source\": \"google_places\",\n        \"attribution\": \"Photo from Google Places\"\n      }\n    ],\n    \"details\": {\n      \"address\": \"86-90 Park Lane, London\",\n      \"rating\": 4.5,\n      \"totalReviews\": 1234\n    },\n    \"cached\": false,\n    \"fallbackUsed\": false,\n    \"message\": \"Hotel images retrieved successfully\"\n  }\n}\n```\n\n**ğŸ”„ Fallback Response (when Google Places unavailable):**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"hotelId\": \"MCLONGHM\",\n    \"hotelName\": \"JW Marriott Grosvenor House London\",\n    \"images\": [\n      {\n        \"url\": \"https://via.placeholder.com/800x600/4A90E2/FFFFFF?text=Hotel+Exterior\",\n        \"type\": \"exterior\",\n        \"source\": \"placeholder\",\n        \"attribution\": \"Generic hotel image\"\n      }\n    ],\n    \"cached\": false,\n    \"fallbackUsed\": true,\n    \"message\": \"Hotel-specific images are currently unavailable. Showing generic hotel images for reference.\"\n  }\n}\n```\n\n**ğŸ§ª Testing Scenarios:**\n\n**Scenario 1: Hotel with Google Places Images**\n```\nGET /api/v1/bookings/hotels/MCLONGHM/images?hotelName=JW+Marriott+Grosvenor+House+London\n```\n- âœ… Returns Google Places images (if API key configured)\n- âœ… Caches in database for 60 days\n- âœ… Returns hotel details (address, rating, reviews)\n\n**Scenario 2: Hotel Not Found in Google Places**\n```\nGET /api/v1/bookings/hotels/UNKNOWNHM/images?hotelName=Very+New+Hotel+London\n```\n- âœ… Returns placeholder images (fallback)\n- âœ… `fallbackUsed: true`\n- âœ… User-friendly message\n- âœ… **No error - always succeeds**\n\n**Scenario 3: Google Places API Key Missing**\n```\n# Remove GOOGLE_PLACES_API_KEY from .env\nGET /api/v1/bookings/hotels/MCLONGHM/images?hotelName=JW+Marriott\n```\n- âœ… Returns placeholder images (fallback)\n- âœ… `fallbackUsed: true`\n- âœ… **Works perfectly without API key**\n\n**Scenario 4: Cached Images**\n```\n# First request: Fetches from Google Places, caches\nGET /api/v1/bookings/hotels/MCLONGHM/images?hotelName=JW+Marriott\n\n# Second request (within 60 days): Returns from cache\nGET /api/v1/bookings/hotels/MCLONGHM/images?hotelName=JW+Marriott\n```\n- âœ… `cached: true` in response\n- âœ… Fast response (no API calls)\n- âœ… No Google Places API usage\n\n**ğŸ“Š Response Fields:**\n- `images[]`: Array of image objects\n  - `url`: Image URL (Cloudinary or placeholder)\n  - `type`: Image type (exterior, interior, room, amenity, other)\n  - `source`: Image source (google_places, placeholder)\n  - `attribution`: Attribution text (if required)\n- `details`: Hotel details from Google Places (if available)\n  - `address`: Full address\n  - `rating`: Hotel rating (1-5)\n  - `totalReviews`: Number of reviews\n- `cached`: Boolean - true if from cache\n- `fallbackUsed`: Boolean - true if using placeholder images\n- `message`: User-friendly message about image source\n\n**ğŸ’¡ Usage Tips:**\n1. **For Hotel Listings:** Lazy load images when card enters viewport\n2. **For Hotel Details Page:** Fetch images immediately on page load\n3. **Cache Strategy:** Frontend can cache image URLs for 24 hours\n4. **Error Handling:** Not needed - endpoint always returns success\n5. **Attribution:** Display \"Powered by Google\" if `source === \"google_places\"`\n\n**ğŸ”— Related Endpoints:**\n- `POST /api/v1/bookings/search/hotels/amadeus` - Get hotelId and hotelName\n- `GET /api/v1/bookings/hotels/accommodation/:accommodationId` - Get Duffel hotel details (may include images)\n\n**âš ï¸ Important Notes:**\n- **Always returns images** - never returns empty array (unless last resort)\n- **Never crashes** - all errors handled gracefully\n- **Works without Google Places API** - uses fallback images\n- **Caching:** Images cached for 60 days, then auto-deleted\n- **Rate Limiting:** Automatically falls back when Google Places limit reached\n- **Cost Control:** Free tier limits enforced, circuit breaker at 90%\n\n**ğŸ¯ Complete Flow Example:**\n```\n1. Search Hotels:\n   POST /api/v1/bookings/search/hotels/amadeus\n   â†’ Get: hotelId=\"MCLONGHM\", hotelName=\"JW Marriott...\"\n\n2. Get Hotel Images:\n   GET /api/v1/bookings/hotels/MCLONGHM/images?hotelName=JW+Marriott+...\n   â†’ Get: images array with URLs\n\n3. Display Hotel Details Page:\n   â†’ Combine search data + images\n   â†’ Show full gallery, hotel info, pricing\n```"
							},
							"response": []
						},
						{
							"name": "Get Hotel Images Usage Stats (Admin Only)",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{token}}"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/api/v1/bookings/hotels/images/usage-stats",
									"host": ["{{baseUrl}}"],
									"path": ["api", "v1", "bookings", "hotels", "images", "usage-stats"]
								},
								"description": "**Get Google Places API and Cloudinary usage statistics (Admin Only)**\n\n**Admin authentication required.**\n\n**ğŸ¯ What This Does:**\n- Returns current month usage for Google Places API requests\n- Returns Cloudinary storage and bandwidth usage\n- Helps monitor costs and free tier limits\n- Shows circuit breaker status (if limits reached)\n\n**âœ… Response Structure:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"googlePlaces\": {\n      \"currentValue\": 150,\n      \"limitValue\": 1000,\n      \"isLimitReached\": false,\n      \"percentageUsed\": 15.0\n    },\n    \"cloudinaryStorage\": {\n      \"currentValue\": 0.5,\n      \"limitValue\": 25.0,\n      \"isLimitReached\": false,\n      \"percentageUsed\": 2.0\n    },\n    \"cloudinaryBandwidth\": {\n      \"currentValue\": 2.3,\n      \"limitValue\": 25.0,\n      \"isLimitReached\": false,\n      \"percentageUsed\": 9.2\n    }\n  }\n}\n```\n\n**ğŸ“Š Response Fields:**\n- `googlePlaces`: Google Places API usage\n  - `currentValue`: Current requests this month\n  - `limitValue`: Free tier limit (default: 1000)\n  - `isLimitReached`: Circuit breaker status (true if â‰¥90% used)\n  - `percentageUsed`: Percentage of limit used\n- `cloudinaryStorage`: Cloudinary storage usage (GB)\n- `cloudinaryBandwidth`: Cloudinary bandwidth usage (GB)\n\n**ğŸ’¡ Usage Tips:**\n- Check monthly to monitor API costs\n- Circuit breaker activates at 90% of free tier limit\n- Usage resets automatically on 1st of each month\n- If `isLimitReached: true`, images endpoint uses fallback only\n\n**âš ï¸ Important:**\n- Only admins can access this endpoint\n- Usage tracking prevents exceeding free tier limits\n- Circuit breaker stops API calls when limit approached"
							},
							"response": []
						}
					]
				}
			],
			"description": "**Hotel booking endpoints - Organized by provider**\n\n**ğŸ“ Folder Structure:**\n1. **Hotels - Amadeus (Recommended)** - Complete Amadeus hotel booking flow\n2. **Hotels - Duffel** - Duffel Stays API endpoints\n3. **Hotels - Common Operations** - Shared endpoints (List, Get, Cancel, Images)\n\n**ğŸ¯ Quick Start:**\n- **For Amadeus**: See \"Hotels - Amadeus (Recommended)\" folder for complete flow\n- **For Duffel**: See \"Hotels - Duffel\" folder (requires account access)\n- **Common Operations**: Works for both providers\n\n**ğŸ–¼ï¸ Hotel Images Flow:**\n1. **Search Hotels** â†’ Get `hotelId` and `hotelName`\n2. **Get Hotel Images** â†’ `GET /api/v1/bookings/hotels/:hotelId/images?hotelName=...`\n3. **Display** â†’ Show images in hotel cards or details page\n\n**ğŸ’¡ Recommendation:**\n- Use **Amadeus** for hotel bookings (free quota, better test data, more features)\n- Use **Duffel** only if you have Duffel Stays access enabled\n- **Hotel Images** endpoint works for both Amadeus and Duffel hotels\n\n**ğŸ” Security:**\n- Card details encrypted with AES-256-GCM\n- Admin-only cancellations\n- Secure payment flow with Stripe\n\n**ğŸ›¡ï¸ Image Fallback:**\n- Hotel images endpoint **never crashes**\n- Automatically falls back to placeholder images if Google Places unavailable\n- Works perfectly without Google Places API key\n- Always returns images (Google Places or fallback)"
		},
		{
			"name": "Flight Utilities",
			"item": [
				{
					"name": "Search Place Suggestions (Airports/Cities)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/flights/places/suggestions?query=london",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "bookings", "flights", "places", "suggestions"],
							"query": [
								{
									"key": "query",
									"value": "london",
									"description": "Search query (min 3 characters)"
								},
								{
									"key": "lat",
									"value": "",
									"description": "Latitude for location-based search",
									"disabled": true
								},
								{
									"key": "lng",
									"value": "",
									"description": "Longitude for location-based search",
									"disabled": true
								},
								{
									"key": "rad",
									"value": "",
									"description": "Radius in metres",
									"disabled": true
								}
							]
						},
						"description": "**Search for airport/city suggestions (autocomplete)**\n\n**No authentication required.**\n\n**What This Does:**\n- Provides autocomplete suggestions for flight search origin/destination\n- Searches by airport name, city name, or IATA code\n- Optional location-based filtering\n\n**Query Parameters:**\n- `query` (string, required): Search query (minimum 3 characters)\n  - Examples: \"london\", \"LHR\", \"heathrow\", \"JFK\"\n- `lat` (number, optional): Latitude for location-based search (-90 to 90)\n- `lng` (number, optional): Longitude for location-based search (-180 to 180)\n- `rad` (number, optional): Search radius in metres\n\n**Response:**\n- Returns airports and cities matching the query\n- Includes IATA codes, names, coordinates\n- Use for origin/destination autocomplete in flight search\n\n**Examples:**\n- `?query=london` - Find all London airports/cities\n- `?query=LHR` - Find Heathrow airport\n- `?query=heathrow&lat=51.5071&lng=-0.1416&rad=10000` - Location-based search"
					},
					"response": []
				},
				{
					"name": "List Airlines",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/bookings/flights/airlines?limit=50",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "bookings", "flights", "airlines"],
							"query": [
								{
									"key": "limit",
									"value": "50",
									"description": "Items per page (1-200, default: 50)"
								},
								{
									"key": "after",
									"value": "",
									"description": "Pagination cursor",
									"disabled": true
								},
								{
									"key": "before",
									"value": "",
									"description": "Previous page cursor",
									"disabled": true
								}
							]
						},
						"description": "**List all airlines**\n\n**No authentication required.**\n\n**What This Does:**\n- Returns paginated list of all airlines\n- Includes airline name, IATA code, logo URLs\n- Useful for displaying airline information in flight results\n\n**Query Parameters:**\n- `limit` (number, optional): Items per page (1-200, default: 50)\n- `after` (string, optional): Cursor for next page\n- `before` (string, optional): Cursor for previous page\n\n**Response:**\n- Returns airlines with:\n  - `name`: Airline name (e.g., \"British Airways\")\n  - `iata_code`: IATA code (e.g., \"BA\")\n  - `logo_symbol_url`: Logo URL\n  - `logo_lockup_url`: Full logo URL\n  - `id`: Duffel airline ID\n\n**Use Case:**\n- Display airline logos in flight results\n- Show airline names\n- Filter flights by airline"
					},
					"response": []
				}
			],
			"description": "Utility endpoints for flight search.\n\n**Place Suggestions:**\n- Autocomplete for origin/destination fields\n- Search by airport name, city name, or IATA code\n- Optional location-based filtering\n- Minimum 3 characters required\n\n**List Airlines:**\n- Get all airlines with logos and IATA codes\n- Paginated results\n- Use for displaying airline information in flight results"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global pre-request script",
					"if (!pm.environment.get('baseUrl')) {",
					"    pm.environment.set('baseUrl', 'http://localhost:3001');",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global test script",
					"console.log('Response time:', pm.response.responseTime + 'ms');"
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:3001",
			"type": "string"
		}
	]
}

